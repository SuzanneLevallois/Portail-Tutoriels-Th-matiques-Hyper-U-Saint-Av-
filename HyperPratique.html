<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portail Tutoriels Th√©matiques - [ Raillons BVP Hyper U Saint Av√© 56890 ]</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* VARIABLES CSS - Pour une gestion facile des couleurs et des tailles */
    :root {
      /* Couleurs inspir√©es du style de la page de login (blanc/gris clair, boutons sombres, ombres douces) */
      --card-bg-color: rgba(255, 255, 255, 0.85); /* Fond principal de la grande carte, tr√®s opaque */
      --secondary-bg-color: rgba(0, 0, 0, 0.8); /* Fond sombre pour les m√©dias (vid√©os) */
      --text-color-dark: #333; /* Texte fonc√© sur fond clair */
      --text-color-light: #f0f0f0; /* Texte clair sur fond sombre */
      
      /* Couleurs pour les boutons align√©es avec la page de login (gris fonc√© des boutons "Se connecter") */
      --main-bg-color: #343a40; /* Couleur par d√©faut des boutons/√©l√©ments principaux */
      --main-bg-color-hover: #23272b; /* Hover */

      --input-bg-color: #f8f9fa; /* Couleur de fond pour les champs de saisie */
      --input-border-color: #ced4da; /* Couleur de bordure pour les champs de saisie */

      --border-radius-large: 20px; /* Plus grand pour un look tactile */
      --border-radius-medium: 12px;
      --shadow-light: 0 4px 10px rgba(0, 0, 0, 0.1);
      --shadow-medium: 0 8px 20px rgba(0, 0, 0, 0.2);
      --shadow-strong: 0 15px 40px rgba(0, 0, 0, 0.4); /* Ombre plus prononc√©e pour l'effet "flottant" */
      --transition-speed: 0.3s;

      /* NOUVEAU: Variables pour les couleurs des cartes et du texte dynamique */
      --dynamic-card-bg: var(--secondary-bg-color); /* Par d√©faut, fond sombre pour les cartes vid√©o */
      --dynamic-text-on-card: var(--text-color-light); /* Par d√©faut, texte clair sur les cartes vid√©o sombres */
      --guided-mode-bg: transparent; /* Fond de la section guid√©e, transparent par d√©faut */
    }

    /* GENERAL STYLES */
    body {
      font-family: 'Montserrat', sans-serif; /* Application de la police */
      background: url('image_672e33.jpg') center center no-repeat;
      background-size: cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center; /* Centrer le contenu sur la page, comme une page de login */
      min-height: 100vh;
      margin: 0;
      padding: 30px 20px;
      box-sizing: border-box;
      color: var(--text-color-dark);
      overflow-y: auto; /* Permet le d√©filement si le contenu est trop grand */
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* CONTENEUR PRINCIPAL - LA GRANDE CARTE DE VERRE D√âPOLI */
    .container {
      width: 100%;
      max-width: 1100px;
      background: var(--card-bg-color); /* Fond pour la carte enti√®re */
      border-radius: var(--border-radius-large);
      box-shadow: var(--shadow-strong); /* Ombre forte et prononc√©e */
      backdrop-filter: blur(35px); /* Effet de flou encore plus prononc√© pour le verre d√©poli */
      -webkit-backdrop-filter: blur(35px);
      border: 1px solid rgba(255, 255, 255, 0.7); /* Bordure subtilement plus visible */
      display: flex;
      flex-direction: column;
      gap: 0; /* Pas de gap entre les sections internes si elles sont fusionn√©es visuellement */
      overflow: hidden; /* Assure que le contenu ne d√©passe pas les bords arrondis */
    }

    /* HEADER - Partie sup√©rieure de la carte */
    .header {
      padding: 25px 35px; /* Augmenter un peu le padding */
      display: flex;
      justify-content: space-between;
      align-items: center;
      /* Background et shadow sont g√©r√©s par le container parent */
    }
    .header h1 {
      font-size: 2.6em;
      color: var(--text-color-dark);
      margin: 0;
      font-weight: 800;
      letter-spacing: -0.8px;
    }
    .logout-button {
      background-color: var(--main-bg-color); /* Utilise la nouvelle variable */
      color: white;
      padding: 12px 25px;
      border: none;
      border-radius: var(--border-radius-medium);
      cursor: pointer;
      font-size: 1.1em;
      font-weight: 600;
      transition: all var(--transition-speed) ease;
      box-shadow: var(--shadow-light);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .logout-button:hover {
      background-color: var(--main-bg-color-hover); /* Utilise la nouvelle variable */
      transform: translateY(-3px);
      box-shadow: var(--shadow-medium);
    }
    .logout-button i {
        font-size: 1.2em;
    }

    /* CONTROLLERS - Zone dynamique principale, partie centrale de la carte */
    .content-area {
      padding: 35px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 600px; /* Assure une taille minimale constante */
      flex-grow: 1; /* Permet √† cette zone de prendre l'espace restant */
      /* Background et shadow sont g√©r√©s par le container parent */
    }
    .content-area > div {
        display: none;
        width: 100%;
        max-width: 900px;
    }
    .content-area > div.active {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 25px;
    }
    /* NOUVEAU: Appliquer la couleur de fond dynamique √† la section guid√©e */
    #guided-wash-mode.active {
        background: var(--guided-mode-bg); /* Applique la couleur/d√©grad√© dynamique ici */
        border-radius: var(--border-radius-large); /* Pour que le fond color√© ait des bords arrondis */
        padding: 35px; /* R√©appliquer le padding pour le contenu interne */
        box-shadow: var(--shadow-medium);
        color: var(--dynamic-text-on-card); /* Ajuste la couleur du texte du titre h2 ici */
    }
    /* S'assurer que le titre de la section guid√©e utilise la couleur dynamique */
    #guided-wash-mode.active h2 {
      color: var(--dynamic-text-on-card); /* Utilisez la variable pour le texte sur les fonds dynamiques */
    }


    /* MAIN MENU */
    #main-menu.active {
        display: flex;
        flex-direction: column;
        gap: 25px;
        width: 100%;
        max-width: 700px;
        align-items: center;
        justify-content: center;
        min-height: 500px;
        position: relative; /* Pour positionner l'engrenage √† l'int√©rieur */
    }
    .menu-item-button {
      background-color: var(--main-bg-color); /* Utilise la nouvelle variable */
      color: white;
      padding: 30px 50px;
      border: none;
      border-radius: var(--border-radius-large);
      cursor: pointer;
      font-size: 2.2em;
      font-weight: 700;
      letter-spacing: 0.5px;
      transition: all var(--transition-speed) ease;
      box-shadow: var(--shadow-medium);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      width: 100%;
    }
    .menu-item-button:hover {
      background-color: var(--main-bg-color-hover); /* Utilise la nouvelle variable */
      transform: translateY(-8px);
      box-shadow: var(--shadow-strong); /* Ombre plus grande au survol */
    }
    .menu-item-button i {
        margin-right: 25px;
        font-size: 1.3em;
        color: rgba(255,255,255,0.7);
    }
    /* Bouton Param√®tres (Engrenage) - Positionn√© en bas √† droite de l'√©cran */
    .settings-global-button {
        position: fixed; /* Position fixe par rapport √† la fen√™tre */
        bottom: 20px;
        right: 20px;
        background-color: var(--main-bg-color); /* Utilise la nouvelle variable */
        color: white;
        border: none;
        border-radius: 50%; /* Rond */
        width: 50px; /* Petite taille */
        height: 50px; /* Petite taille */
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.8em; /* Taille de l'ic√¥ne */
        cursor: pointer;
        box-shadow: var(--shadow-medium);
        transition: all var(--transition-speed) ease;
        z-index: 1000; /* Assure qu'il est au-dessus du reste */
    }
    .settings-global-button:hover {
        background-color: var(--main-bg-color-hover); /* Utilise la nouvelle variable */
        transform: scale(1.1) rotate(20deg); /* L√©g√®re rotation et agrandissement */
        box-shadow: var(--shadow-strong);
    }


    /* COMMON MODE STYLES */
    .mode-section h2 {
        font-size: 2.5em;
        color: var(--text-color-dark);
        margin-bottom: 25px;
        font-weight: 800;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.08);
        text-align: center;
    }

    .back-to-menu-button {
        background-color: var(--main-bg-color); /* Utilise la nouvelle variable */
        color: white;
        padding: 14px 30px;
        border: none;
        border-radius: var(--border-radius-medium);
        cursor: pointer;
        font-size: 1.2em;
        font-weight: 600;
        transition: all var(--transition-speed) ease;
        margin-top: 35px;
        box-shadow: var(--shadow-light);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .back-to-menu-button:hover {
        background-color: var(--main-bg-color-hover); /* Utilise la nouvelle variable */
        transform: translateY(-3px);
        box-shadow: var(--shadow-medium);
    }
    .back-to-menu-button i {
        font-size: 1.1em;
    }

    /* VIDEO PLAYER (Lavage Guid√©) */
    .video-player-container {
      width: 100%;
      max-width: 900px;
      background-color: var(--secondary-bg-color);
      border-radius: var(--border-radius-medium);
      overflow: hidden;
      box-shadow: var(--shadow-medium);
      position: relative;
      padding-bottom: 56.25%; /* Ratio 16:9 */
      height: 0;
      margin-top: 20px;
    }
    .video-player-container video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    .video-controls {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        margin-top: 25px;
        width: 100%;
    }
    .video-controls button {
        background-color: var(--main-bg-color); /* Utilise la nouvelle variable */
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: var(--border-radius-medium);
        cursor: pointer;
        font-size: 1.2em;
        font-weight: 600;
        transition: all var(--transition-speed) ease;
        box-shadow: var(--shadow-light);
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .video-controls button:hover {
        background-color: var(--main-bg-color-hover); /* Utilise la nouvelle variable */
        transform: translateY(-3px);
        box-shadow: var(--shadow-medium);
    }
    .video-controls button[disabled] {
        background-color: #bbb;
        cursor: not-allowed;
        opacity: 0.7;
        transform: none;
        box-shadow: none;
    }
    .video-controls button i {
        font-size: 1em;
    }
    /* NOUVEAU: Bouton Info/M√©mo */
    .info-memo-button {
      background-color: #007bff; /* Bleu primaire */
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: var(--border-radius-medium);
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      transition: all var(--transition-speed) ease;
      box-shadow: var(--shadow-light);
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px; /* Espacement apr√®s les contr√¥les vid√©o */
      margin-bottom: 20px;
    }
    .info-memo-button:hover {
      background-color: #0056b3; /* Bleu plus fonc√© au survol */
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    /* VIDEO GRID (Vid√©oth√®que) & THEME GRID */
    .video-grid, .theme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 30px;
      width: 100%;
      max-width: 950px;
      margin-top: 25px;
    }
    .video-item, .theme-item {
      background: var(--dynamic-card-bg); /* Utilise la nouvelle variable dynamique */
      border-radius: var(--border-radius-medium);
      overflow: hidden;
      box-shadow: var(--shadow-medium);
      cursor: pointer;
      transition: all var(--transition-speed) ease;
      /* color: var(--dynamic-text-on-card); <- Ce n'est plus appliqu√© ici pour theme-item */
      text-align: left;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    /* Adapte le texte des cartes vid√©o √† leur fond */
    .video-item
Sp√©cificit√© : (0,1,0)
 {
    color: #ffffff;
}

    .video-item:hover, .theme-item:hover {
      transform: scale(1.03);
      box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    }
    .video-item img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      display: block;
    }
    .video-item .play-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 180px;
        background-color: rgba(0,0,0,0.4);
        display: flex;
        justify-content: center;
        align-items: center;
        opacity: 0;
        transition: opacity var(--transition-speed) ease;
    }
    .video-item:hover .play-overlay {
        opacity: 1;
    }
    .video-item .play-overlay i {
        font-size: 3em;
        color: #ffffff;
    }
    .video-item-info, .theme-item-info {
      padding: 18px;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .video-item-info h3, .theme-item-info h3 {
      font-size: 1.4em;
      margin: 0 0 10px 0;
      Sp√©cificit√© : (0,1,0)
 {
    color: #ffffff;
}
; /* Utilise la couleur du parent */
      font-weight: 600;
    }
    .video-item-info p {
      font-size: 0.95em;
      color: inherit; /* Utilise la couleur du parent */
      margin: 0;
      line-height: 1.4;
    }
    .theme-item {
        background-color: var(--main-bg-color); /* Par d√©faut, utilise la couleur principale des boutons */
        justify-content: center;
        align-items: center;
        min-height: 180px; /* Taille minimale pour les √©l√©ments de th√®me */
        text-align: center;
        gap: 15px;
        color: white; /* NOUVEAU: Le texte des th√®mes est TOUJOURS blanc */
    }
    .theme-item .theme-icon {
        font-size: 3em;
        color: white; /* NOUVEAU: L'ic√¥ne des th√®mes est TOUJOURS blanche */
    }
    .theme-item .theme-title {
        font-size: 1.8em;
        color: white; /* NOUVEAU: Le titre des th√®mes est TOUJOURS blanc */
        font-weight: 700;
        margin: 0;
    }


    /* INFOS FSQS */
    .fsqs-info-content {
        padding: 25px;
        text-align: left;
        color: var(--text-color-dark);
        font-size: 1.15em;
        line-height: 1.8;
        max-width: 850px;
    }
    .fsqs-info-content h2 {
        font-size: 2.8em;
        margin-bottom: 25px;
        text-align: center;
        font-weight: 800;
        color: var(--text-color-dark);
    }
    .fsqs-info-content h3 {
        font-size: 2em;
        margin-top: 40px;
        margin-bottom: 18px;
        font-weight: 700;
        color: var(--main-bg-color); /* Utilise la nouvelle variable */
    }
    .fsqs-info-content p {
        margin-bottom: 20px;
    }
    .fsqs-info-content ul {
        list-style-type: none; /* Supprime les puces par d√©faut */
        padding-left: 0;
        margin-bottom: 25px;
    }
    .fsqs-info-content ul li {
        position: relative;
        padding-left: 30px;
        margin-bottom: 12px;
    }
    .fsqs-info-content ul li::before {
        content: "\f058"; /* Ic√¥ne de coche Font Awesome */
        font-family: "Font Awesome 6 Free";
        font-weight: 900;
        color: #28a745; /* Vert pour la coche (peut rester vif pour la validation) */
        position: absolute;
        left: 0;
        top: 2px;
        font-size: 1.1em;
    }
    .fsqs-info-content img {
        max-width: 95%;
        height: auto;
        border-radius: var(--border-radius-large);
        margin: 40px auto;
        display: block;
        box-shadow: var(--shadow-medium);
        border: 1px solid rgba(255, 255, 255, 0.4);
    }
    .fsqs-info-content em {
        display: block;
        text-align: center;
        font-size: 1.2em;
        color: #555;
        margin-top: 25px;
        font-style: italic;
        font-weight: 600;
    }

    /* SETTINGS MODE */
    .settings-form {
        width: 100%;
        max-width: 600px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        margin-top: 20px;
    }
    .settings-form label {
        font-weight: 600;
        margin-bottom: 5px;
        display: block;
        font-size: 1.1em;
        color: var(--text-color-dark);
    }
    .settings-form input[type="text"],
    .settings-form input[type="url"],
    .settings-form select,
    .settings-form textarea,
    .settings-form input[type="color"] { /* Added type color */
        width: 100%;
        padding: 12px 15px;
        border: 1px solid var(--input-border-color);
        border-radius: var(--border-radius-medium);
        font-family: 'Montserrat', sans-serif;
        font-size: 1em;
        background-color: var(--input-bg-color);
        color: var(--text-color-dark);
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    .settings-form input[type="text"]:focus,
    .settings-form input[type="url"]:focus,
    .settings-form select:focus,
    .settings-form textarea:focus,
    .settings-form input[type="color"]:focus { /* Added type color */
        outline: none;
        border-color: var(--main-bg-color); /* Utilise la nouvelle variable */
        box-shadow: 0 0 0 3px rgba(52, 58, 64, 0.25);
    }
    .settings-form button {
        background-color: var(--main-bg-color); /* Utilise la nouvelle variable */
        color: white;
        padding: 12px 25px;
        border: none;
        border-radius: var(--border-radius-medium);
        cursor: pointer;
        font-size: 1.1em;
        font-weight: 600;
        transition: all var(--transition-speed) ease;
        box-shadow: var(--shadow-light);
        margin-top: 10px;
    }
    .settings-form button:hover {
        background-color: var(--main-bg-color-hover); /* Utilise la nouvelle variable */
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
    }
    .settings-form button[disabled] {
        background-color: #bbb;
        cursor: not-allowed;
        opacity: 0.7;
        transform: none;
        box-shadow: none;
    }
    .settings-group {
        background-color: rgba(255, 255, 255, 0.6); /* Un peu plus transparent pour les groupes */
        padding: 20px;
        border-radius: var(--border-radius-medium);
        box-shadow: var(--shadow-light);
        border: 1px solid rgba(255, 255, 255, 0.5);
    }
    .settings-group h3 {
        font-size: 1.6em;
        margin-top: 0;
        margin-bottom: 15px;
        color: var(--main-bg-color); /* Utilise la nouvelle variable */
        font-weight: 700;
    }

    /* Styles pour la gestion des playlists de th√®mes (drag and drop ou r√©ordonnancement) */
    .playlist-management-list {
        list-style-type: none;
        padding: 0;
        margin: 15px 0;
        border: 1px solid var(--input-border-color);
        border-radius: var(--border-radius-medium);
        background-color: var(--input-bg-color);
        max-height: 300px;
        overflow-y: auto;
    }
    .playlist-management-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 15px;
        border-bottom: 1px solid var(--input-border-color);
        color: var(--text-color-dark);
        font-size: 1em;
    }
    .playlist-management-item:last-child {
        border-bottom: none;
    }
    .playlist-management-item span {
        flex-grow: 1;
    }
    .playlist-management-item button {
        background: none;
        border: none;
        color: var(--main-bg-color); /* Utilise la nouvelle variable */
        font-size: 1.2em;
        cursor: pointer;
        margin-left: 10px;
        transition: color var(--transition-speed) ease;
        padding: 5px; /* Added padding to make click area larger */
        box-shadow: none; /* No shadow for these small buttons */
        margin-top: 0;
    }
    .playlist-management-item button:hover {
        color: var(--main-bg-color-hover); /* Utilise la nouvelle variable */
        transform: none; /* No transform for these */
        box-shadow: none;
    }
    /* Add Video to Theme buttons */
    .add-video-to-theme-btn {
        background-color: #28a745; /* Green color for adding, will be dynamic */
        color: white;
        padding: 8px 15px;
        border: none;
        border-radius: var(--border-radius-medium);
        cursor: pointer;
        font-size: 0.9em;
        transition: background-color var(--transition-speed) ease;
        margin-top: 0;
        box-shadow: var(--shadow-light);
    }
    .add-video-to-theme-btn:hover {
        background-color: #218838;
        transform: translateY(-2px);
    }

    /* NOUVEAU: Styles pour la popup (modale) */
    .modal {
      display: none; /* Hidden by default */
      position: fixed; /* Stay in place */
      z-index: 2000; /* Sit on top */
      left: 0;
      top: 0;
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      overflow: auto; /* Enable scroll if needed */
      background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
      backdrop-filter: blur(5px); /* Flou derri√®re la modale */
      -webkit-backdrop-filter: blur(5px);
      padding-top: 60px;
    }
    .modal-content {
      background-color: var(--card-bg-color);
      margin: 5% auto; /* 5% from the top and centered */
      padding: 30px;
      border-radius: var(--border-radius-large);
      box-shadow: var(--shadow-strong);
      width: 80%; /* Could be more responsive */
      max-width: 800px;
      position: relative;
      color: var(--text-color-dark);
      animation-name: animatetop;
      animation-duration: 0.4s
    }
    /* Add Animation */
    @keyframes animatetop {
      from {top: -300px; opacity: 0}
      to {top: 0; opacity: 1}
    }

    .close-button {
      color: var(--text-color-dark);
      position: absolute;
      top: 15px;
      right: 25px;
      font-size: 35px;
      font-weight: bold;
      transition: 0.3s;
    }
    .close-button:hover,
    .close-button:focus {
      color: #bbb;
      text-decoration: none;
      cursor: pointer;
    }
    .modal-content h3 {
        font-size: 2em;
        color: var(--main-bg-color);
        margin-top: 0;
        margin-bottom: 20px;
        text-align: center;
    }
    .modal-content p, .modal-content ul, .modal-content ol {
        font-size: 1.1em;
        line-height: 1.6;
        margin-bottom: 15px;
    }
    .modal-content img {
        max-width: 100%;
        height: auto;
        border-radius: var(--border-radius-medium);
        margin: 20px auto;
        display: block;
        box-shadow: var(--shadow-light);
    }


    /* FOOTER - Partie inf√©rieure de la carte */
    .footer {
      padding: 15px 25px;
      text-align: center;
      color: var(--text-color-dark);
      font-size: 0.95em;
      /* Background et shadow sont g√©r√©s par le container parent */
    }

    /* RESPONSIVE DESIGN */
    @media (max-width: 1024px) { /* Tablets in portrait */
        .header h1 { font-size: 2.2em; }
        .menu-item-button { font-size: 1.8em; padding: 25px 40px; }
        .menu-item-button i { margin-right: 15px; font-size: 1.1em; }
        .settings-global-button { width: 45px; height: 45px; font-size: 1.6em; bottom: 15px; right: 15px; }
        .mode-section h2 { font-size: 2.2em; }
        .video-controls button { padding: 12px 25px; font-size: 1.1em; }
        .video-grid, .theme-grid { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .video-item img { height: 160px; }
        .video-item .play-overlay { height: 160px; }
        .fsqs-info-content h2 { font-size: 2.4em; }
        .fsqs-info-content h3 { font-size: 1.8em; }
        .settings-group h3 { font-size: 1.4em; }
        .modal-content { width: 90%; margin: 2% auto; }
        .close-button { font-size: 30px; top: 10px; right: 20px; }
    }

    @media (max-width: 768px) { /* Smaller tablets / large phones */
        body { padding: 15px; }
        .container { gap: 0; }
        .header { padding: 15px 25px; }
        .header h1 { font-size: 1.8em; }
        .logout-button { padding: 10px 20px; font-size: 1em; }
        .content-area { padding: 25px; min-height: 500px; }
        #main-menu.active { gap: 20px; max-width: 500px; min-height: 400px; }
        .menu-item-button { font-size: 1.5em; padding: 20px 30px; }
        .menu-item-button i { margin-right: 12px; font-size: 1em; }
        .settings-global-button { width: 40px; height: 40px; font-size: 1.4em; bottom: 10px; right: 10px; }
        .mode-section h2 { font-size: 1.8em; }
        .back-to-menu-button { padding: 10px 20px; font-size: 1em; margin-top: 25px; }
        .video-player-container { max-width: 100%; }
        .video-controls button { padding: 10px 20px; font-size: 1em; }
        .video-grid, .theme-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .video-item img { height: 120px; }
        .video-item .play-overlay { height: 120px; }
        .video-item-info h3 { font-size: 1.2em; }
        .video-item-info p { font-size: 0.9em; }
        .fsqs-info-content { font-size: 1em; padding: 20px; }
        .fsqs-info-content h2 { font-size: 2em; }
        .fsqs-info-content h3 { font-size: 1.6em; }
        .fsqs-info-content ul li { padding-left: 25px; }
        .settings-form { max-width: 100%; }
        .settings-group { padding: 15px; }
        .settings-group h3 { font-size: 1.2em; }
        .settings-form input, .settings-form select, .settings-form textarea { padding: 10px 12px; }
        .info-memo-button { padding: 8px 15px; font-size: 0.9em; }
    }

    @media (max-width: 480px) { /* Mobile phones */
        body { padding: 10px; }
        .header { flex-direction: column; gap: 10px; padding: 15px; }
        .header h1 { font-size: 1.5em; text-align: center; }
        .logout-button { width: 100%; max-width: 200px; }
        .content-area { padding: 20px; min-height: 400px; }
        #main-menu.active { gap: 15px; min-height: 300px; }
        .menu-item-button { font-size: 1.3em; padding: 18px 25px; }
        .menu-item-button i { margin-right: 10px; font-size: 0.9em; }
        .settings-global-button { width: 35px; height: 35px; font-size: 1.2em; bottom: 5px; right: 5px; }
        .mode-section h2 { font-size: 1.6em; }
        .video-grid, .theme-grid { grid-template-columns: 1fr; } /* Single column for small screens */
        .video-item img { height: 180px; } /* Taller in single column */
        .video-item .play-overlay { height: 180px; }
        .fsqs-info-content { font-size: 0.95em; padding: 15px; }
        .fsqs-info-content h2 { font-size: 1.8em; }
        .fsqs-info-content h3 { font-size: 1.3em; }
        .fsqs-info-content ul li { padding-left: 25px; }
        .settings-group h3 { font-size: 1.1em; }
        .info-memo-button { font-size: 0.8em; padding: 6px 12px; }
    }
  </style>
</head>
<body>

  <div class="container">
    <header class="header">
      <h1>Portail Tutoriels Th√©matiques</h1>
      <button class="logout-button"><i class="fas fa-sign-out-alt"></i> D√©connexion</button>
    </header>

    <main class="content-area">
      
      <div id="main-menu" class="active">
        <button class="menu-item-button" data-target="guided-themes-mode"><i class="fas fa-book-open"></i> Tutoriels Th√©matiques</button>
        <button class="menu-item-button" data-target="video-library-mode"><i class="fas fa-video"></i> Vid√©oth√®que Compl√®te</button>
        <button class="menu-item-button" data-target="fsqs-info-mode"><i class="fas fa-info-circle"></i> Informations FSQS Essentielles</button>
      </div>

      <div id="guided-themes-mode" class="mode-section">
        <h2><i class="fas fa-th-list"></i> Choisir un Th√®me de Tutoriel</h2>
        <div class="theme-grid" id="themeGrid">
          </div>
        <button class="back-to-menu-button" data-target-mode="main-menu"><i class="fas fa-arrow-left"></i> Retour au Menu Principal</button>
      </div>

      <div id="guided-wash-mode" class="mode-section">
        <h2 id="guidedThemeTitle"></h2> <div class="video-player-container">
          <video id="guidedVideoPlayer" playsinline>
            Votre navigateur ne supporte pas la lecture de vid√©os.
          </video>
        </div>
        <div class="video-controls">
          <button id="playPauseBtn"><i class="fas fa-pause"></i> Pause</button>
          <button id="rewindBtn"><i class="fas fa-backward"></i> -10s</button>
          <button id="forwardBtn"><i class="fas fa-forward"></i> +10s</button>
          <button id="prevSeqBtn" disabled><i class="fas fa-step-backward"></i> Vid√©o Pr√©c√©dente</button>
          <button id="nextSeqBtn"><i class="fas fa-step-forward"></i> Vid√©o Suivante</button>
          <button id="restartSeqBtn"><i class="fas fa-redo"></i> Recommencer S√©quence</button>
          <button id="fullscreenGuidedBtn"><i class="fas fa-expand"></i> Plein √âcran</button>
        </div>
        <button id="infoMemoBtn" class="info-memo-button" style="display: none;"><i class="fas fa-info-circle"></i> Fiche M√©mo</button>
        <button class="back-to-menu-button" data-target-mode="guided-themes-mode"><i class="fas fa-arrow-left"></i> Retour aux Th√®mes</button>
      </div>

      <div id="video-library-mode" class="mode-section">
        <h2><i class="fas fa-video"></i> Vid√©oth√®que Compl√®te</h2>
        <div class="video-player-container" id="libraryVideoPlayerContainer" style="display:none;">
          <video id="libraryVideoPlayer" controls playsinline>
            Votre navigateur ne supporte pas la lecture de vid√©os.
          </video>
          <div class="video-controls" style="margin-top: 15px;"> <button id="fullscreenLibraryBtn"><i class="fas fa-expand"></i> Plein √âcran</button>
          </div>
        </div>
        <div class="video-grid" id="videoThumbnails">
          </div>
        <button class="back-to-menu-button" data-target-mode="main-menu"><i class="fas fa-arrow-left"></i> Retour au Menu Principal</button>
      </div>

      <div id="fsqs-info-mode" class="mode-section">
        <h2><i class="fas fa-info-circle"></i> Informations FSQS Essentielles</h2>
        <div class="fsqs-info-content" id="fsqsInfoContentDisplay">
          </div>
        <button class="back-to-menu-button" data-target-mode="main-menu"><i class="fas fa-arrow-left"></i> Retour au Menu Principal</button>
      </div>

      <div id="settings-mode" class="mode-section">
        <h2><i class="fas fa-cog"></i> Param√®tres du Portail</h2>
        <form class="settings-form">
          <div class="settings-group">
            <h3>Gestion des Vid√©os (Vid√©oth√®que)</h3>
            <label for="editVideoSelect">S√©lectionner une Vid√©o √† Modifier/Supprimer ou Cr√©er :</label>
            <select id="editVideoSelect">
              <option value="">-- Cr√©er une nouvelle vid√©o --</option>
              </select>

            <label for="videoTitle">Titre de la Vid√©o :</label>
            <input type="text" id="videoTitle" placeholder="Ex: Lavage des mains avanc√©">

            <label for="videoUrl">URL de la Vid√©o (Cloudinary) :</label>
            <input type="url" id="videoUrl" placeholder="https://res.cloudinary.com/.../ma_video.mp4">

            <label for="videoThumbnail">URL de la Miniature (Cloudinary) :</label>
            <input type="url" id="videoThumbnail" placeholder="https://res.com/.../ma_miniature.jpg">

            <label for="videoDescription">Description :</label>
            <textarea id="videoDescription" rows="3" placeholder="Description courte de la vid√©o..."></textarea>

            <button type="button" id="addNewVideoBtn"><i class="fas fa-plus-circle"></i> Ajouter Nouvelle Vid√©o</button>
            <button type="button" id="modifyVideoBtn" disabled><i class="fas fa-edit"></i> Modifier la Vid√©o S√©lectionn√©e</button>
            <button type="button" id="deleteVideoBtn" disabled style="background-color: #dc3545;"><i class="fas fa-trash-alt"></i> Supprimer la Vid√©o S√©lectionn√©e</button>
          </div>

          <div class="settings-group">
            <h3>Gestion des Th√®mes de Tutoriels</h3>
            <label for="themeTitleInput">Titre du Nouveau Th√®me :</label>
            <input type="text" id="themeTitleInput" placeholder="Ex: Lavage des Mains">
            
            <label for="themeIconInput">Ic√¥ne du Th√®me (emoji ou nom FontAwesome) :</label>
            <input type="text" id="themeIconInput" placeholder="üßº ou fas fa-hand-sparkles">
            
            <label for="themeBackgroundInput">Image de fond du th√®me (URL optionnelle) :</label>
            <input type="url" id="themeBackgroundInput" placeholder="https://exemple.com/image.jpg">
            
            <button type="button" id="addThemeBtn"><i class="fas fa-plus-circle"></i> Ajouter Th√®me</button>

            <h4>Modifier un Th√®me Existant</h4>
            <label for="editThemeSelect">S√©lectionner un Th√®me :</label>
            <select id="editThemeSelect"></select>
            
            <label for="editThemeIconInput">Ic√¥ne du Th√®me :</label>
            <input type="text" id="editThemeIconInput" placeholder="üßº ou fas fa-hand-sparkles">
            
            <label for="editThemeBackgroundInput">Image de fond du th√®me :</label>
            <input type="url" id="editThemeBackgroundInput" placeholder="https://exemple.com/image.jpg">
            
            <label for="themePlaylistInput">Vid√©os du Th√®me (titres exacts s√©par√©s par des virgules) :</label>
            <textarea id="themePlaylistInput" rows="3" placeholder="Lavage Standard Mains, Proc√©dure Gel Hydroalcoolique"></textarea>
            <button type="button" id="updateThemeBtn"><i class="fas fa-sync-alt"></i> Mettre √† jour Th√®me</button>
            <button type="button" id="deleteThemeBtn" style="background-color: #dc3545;"><i class="fas fa-trash-alt"></i> Supprimer Th√®me</button>

            <h4>Ajouter une vid√©o √† la playlist d'un th√®me</h4>
            <label for="selectVideoToAdd">Vid√©o √† ajouter :</label>
            <select id="selectVideoToAdd"></select>
            <button type="button" id="addSelectedVideoToThemeBtn"><i class="fas fa-plus"></i> Ajouter √† la playlist du th√®me s√©lectionn√©</button>
          </div>

          <div class="settings-group">
            <h3>Export/Import des Donn√©es</h3>
            <p>Exportez toutes vos donn√©es (vid√©os, th√®mes, param√®tres) vers un fichier JSON ou importez-les depuis un fichier.</p>
            
            <button type="button" id="exportDataBtn"><i class="fas fa-download"></i> Exporter toutes les donn√©es (JSON)</button>
            
            <label for="importDataFile">Importer des donn√©es depuis un fichier JSON :</label>
            <input type="file" id="importDataFile" accept=".json" style="margin-bottom: 10px;">
            <button type="button" id="importDataBtn"><i class="fas fa-upload"></i> Importer les donn√©es</button>
          </div>

          <div class="settings-group">
            <h3>Gestion des Informations FSQS (Texte)</h3>
            <label for="fsqsInfoText">Contenu des Informations FSQS (HTML accept√©) :</label>
            <textarea id="fsqsInfoText" rows="15"></textarea>
            <button type="button" id="updateFsqsInfoBtn"><i class="fas fa-save"></i> Mettre √† jour les Informations</button>
          </div>

          <div class="settings-group">
            <h3>Th√®me et Affichage</h3>
            <label for="themeSelect">S√©lectionner un Th√®me d'Interface :</label>
            <select id="themeSelect">
              <option value="default">Th√®me par D√©faut (Clair)</option>
              <option value="dark">Th√®me Sombre</option>
            </select>
            <button type="button" id="applyThemeBtn"><i class="fas fa-palette"></i> Appliquer Th√®me</button>

            <label for="backgroundImageUrl">URL de l'Image d'Arri√®re-plan :</label>
            <input type="url" id="backgroundImageUrl" placeholder="https://res.cloudinary.com/.../mon_image_fond.jpg">
            <button type="button" id="applyBackgroundBtn"><i class="fas fa-image"></i> Appliquer Fond</button>
          </div>

          <div class="settings-group">
            <h3>Vid√©o de Pause Globale (entre les vid√©os de s√©quence)</h3>
            <label for="pauseVideoUrl">URL de la Vid√©o de Pause :</label>
            <input type="url" id="pauseVideoUrl" placeholder="URL de votre vid√©o de pause">
            <button type="button" id="setPauseVideoBtn"><i class="fas fa-save"></i> Enregistrer URL Pause Vid√©o</button>
          </div>

          <div class="settings-group">
            <h3>Personnalisation des Couleurs</h3>
            <label for="colorApplyTo">Appliquer la Couleur/D√©grad√© √† :</label>
            <select id="colorApplyTo">
              <option value="site">Tout le Portail</option>
              <option value="theme">Un Th√®me Sp√©cifique</option>
            </select>

            <div id="themeColorSelector" style="display:none;">
              <label for="selectThemeForColor">S√©lectionner un Th√®me :</label>
              <select id="selectThemeForColor"></select>
            </div>

            <label for="colorPreset">Couleurs Pr√©d√©finies :</label>
            <select id="colorPreset">
              <option value="">-- Choisir une couleur pr√©d√©finie --</option>
              <option value="#1a5276">Bleu Oc√©an (Propret√©)</option>
              <option value="#218838">Vert For√™t (S√©curit√©)</option>
              <option value="#8e44ad">Violet Myst√®re (Cr√©ativit√©)</option>
              <option value="#f39c12">Jaune Soleil (Attention)</option>
              <option value="#007bff">Bleu Primaire</option>
              <option value="#6c757d">Gris Secondaire</option>
              <option value="linear-gradient(to right, #1a5276, #28b463)">D√©grad√© Bleu-Vert</option>
              <option value="linear-gradient(to right, #f39c12, #e67e22)">D√©grad√© Jaune-Orange</option>
            </select>
            
            <label for="customColorCode">Ou Code Couleur/D√©grad√© Personnalis√© (Hex, RGB, HSL, linear-gradient, etc.) :</label>
            <input type="text" id="customColorCode" placeholder="#343a40 ou linear-gradient(to right, #color1, #color2)">
            <input type="color" id="colorPicker" value="#343a40" style="width: 100%; height: 40px; margin-top: 10px;">

            <button type="button" id="applyColorBtn"><i class="fas fa-fill-drip"></i> Appliquer Couleur</button>
            <button type="button" id="resetColorsBtn" style="background-color: #dc3545;"><i class="fas fa-redo"></i> R√©initialiser Couleurs</button>
          </div>
          <div class="settings-group">
            <h3>Gestion des Fiches M√©mo (Popups)</h3>
            <label for="selectThemeForMemo">S√©lectionner un Th√®me :</label>
            <select id="selectThemeForMemo">
              <option value="">-- Choisir un th√®me --</option>
            </select>

            <label for="selectVideoForMemo" id="labelSelectVideoForMemo" style="display:none;">S√©lectionner une Vid√©o du Th√®me :</label>
            <select id="selectVideoForMemo" style="display:none;">
              <option value="">-- Choisir une vid√©o --</option>
            </select>

            <label for="memoContentTextarea" id="labelMemoContentTextarea" style="display:none;">Contenu de la Fiche M√©mo (HTML accept√©) :</label>
            <textarea id="memoContentTextarea" rows="10" style="display:none;"></textarea>
            <button type="button" id="updateMemoContentBtn" style="display:none;"><i class="fas fa-save"></i> Mettre √† jour la Fiche M√©mo</button>
          </div>
          </form>
        <button class="back-to-menu-button" data-target-mode="main-menu"><i class="fas fa-arrow-left"></i> Retour au Menu Principal</button>
      </div>

    </main>

    <footer class="footer">
      <p>¬© 2025 [ Raillons BVP Hyper U Saint Av√© 56890 ]. Tous droits r√©serv√©s.</p>
    </footer>
  </div>

  <button class="settings-global-button" id="settingsGlobalBtn" title="Param√®tres">
    <i class="fas fa-cog"></i>
  </button>

  <div id="memoModal" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h3 id="memoModalTitle"></h3>
      <div id="memoModalContent">
        </div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const contentArea = document.querySelector('.content-area');
      const mainMenu = document.getElementById('main-menu');
      const menuButtons = document.querySelectorAll('.menu-item-button');
      const backToMenuButtons = document.querySelectorAll('.back-to-menu-button');
      const logoutButton = document.querySelector('.logout-button');
      const settingsGlobalBtn = document.getElementById('settingsGlobalBtn'); 

      // --- R√©f√©rences aux √©l√©ments vid√©o/audio ---
      const guidedVideoPlayer = document.getElementById('guidedVideoPlayer');
      const libraryVideoPlayer = document.getElementById('libraryVideoPlayer');
      
      const playPauseBtn = document.getElementById('playPauseBtn');
      const rewindBtn = document.getElementById('rewindBtn');
      const forwardBtn = document.getElementById('forwardBtn');
      const prevSeqBtn = document.getElementById('prevSeqBtn');
      const nextSeqBtn = document.getElementById('nextSeqBtn');
      const restartSeqBtn = document.getElementById('restartSeqBtn');
      const fullscreenGuidedBtn = document.getElementById('fullscreenGuidedBtn'); 
      const guidedThemeTitle = document.getElementById('guidedThemeTitle');

      const libraryVideoPlayerContainer = document.getElementById('libraryVideoPlayerContainer');
      const fullscreenLibraryBtn = document.getElementById('fullscreenLibraryBtn'); 
      const videoThumbnailsContainer = document.getElementById('videoThumbnails');
      const themeGrid = document.getElementById('themeGrid');

      // --- R√©f√©rences aux √©l√©ments des param√®tres ---
      const applyThemeBtn = document.getElementById('applyThemeBtn');
      const themeSelect = document.getElementById('themeSelect');
      const applyBackgroundBtn = document.getElementById('applyBackgroundBtn');
      const backgroundImageUrlInput = document.getElementById('backgroundImageUrl');
      
      // Nouvelle gestion des vid√©os dans les param√®tres
      const editVideoSelect = document.getElementById('editVideoSelect');
      const addNewVideoBtn = document.getElementById('addNewVideoBtn');
      const modifyVideoBtn = document.getElementById('modifyVideoBtn');
      const deleteVideoBtn = document.getElementById('deleteVideoBtn');

      const videoTitleInput = document.getElementById('videoTitle');
      const videoUrlInput = document.getElementById('videoUrl');
      const videoThumbnailInput = document.getElementById('videoThumbnail');
      const videoDescriptionInput = document.getElementById('videoDescription');
      
      const pauseVideoUrlInput = document.getElementById('pauseVideoUrl');
      const setPauseVideoBtn = document.getElementById('setPauseVideoBtn');

      const themeIconInput = document.getElementById('themeIconInput');
      const themeBackgroundInput = document.getElementById('themeBackgroundInput');
      const editThemeIconInput = document.getElementById('editThemeIconInput');
      const editThemeBackgroundInput = document.getElementById('editThemeBackgroundInput');
      
      // Export/Import elements
      const exportDataBtn = document.getElementById('exportDataBtn');
      const importDataBtn = document.getElementById('importDataBtn');
      const importDataFile = document.getElementById('importDataFile');
      const addThemeBtn = document.getElementById('addThemeBtn');
      const editThemeSelect = document.getElementById('editThemeSelect');
      const themePlaylistInput = document.getElementById('themePlaylistInput');
      const updateThemeBtn = document.getElementById('updateThemeBtn');
      const deleteThemeBtn = document.getElementById('deleteThemeBtn');
      const selectVideoToAdd = document.getElementById('selectVideoToAdd');
      const addSelectedVideoToThemeBtn = document.getElementById('addSelectedVideoToThemeBtn');
      
      const fsqsInfoTextarea = document.getElementById('fsqsInfoText');
      const updateFsqsInfoBtn = document.getElementById('updateFsqsInfoBtn');
      const fsqsInfoContentDisplay = document.getElementById('fsqsInfoContentDisplay');

      // --- NOUVEAU: R√©f√©rences aux √©l√©ments des param√®tres de couleurs ---
      const colorApplyToSelect = document.getElementById('colorApplyTo');
      const themeColorSelectorDiv = document.getElementById('themeColorSelector');
      const selectThemeForColor = document.getElementById('selectThemeForColor');
      const colorPresetSelect = document.getElementById('colorPreset');
      const customColorCodeInput = document.getElementById('customColorCode');
      const colorPickerInput = document.getElementById('colorPicker');
      const applyColorBtn = document.getElementById('applyColorBtn');
      const resetColorsBtn = document.getElementById('resetColorsBtn');

      // --- NOUVEAU: R√©f√©rences aux √©l√©ments de la gestion des fiches m√©mo ---
      const selectThemeForMemo = document.getElementById('selectThemeForMemo');
      const selectVideoForMemo = document.getElementById('selectVideoForMemo');
      const memoContentTextarea = document.getElementById('memoContentTextarea');
      const updateMemoContentBtn = document.getElementById('updateMemoContentBtn');
      const labelSelectVideoForMemo = document.getElementById('labelSelectVideoForMemo');
      const labelMemoContentTextarea = document.getElementById('labelMemoContentTextarea');

      // --- NOUVEAU: R√©f√©rences aux √©l√©ments de la modale (popup) ---
      const memoModal = document.getElementById('memoModal');
      const memoModalTitle = document.getElementById('memoModalTitle');
      const memoModalContent = document.getElementById('memoModalContent');
      const closeModalBtn = document.querySelector('.close-button');
      const infoMemoBtn = document.getElementById('infoMemoBtn');

      // --- Donn√©es et Variables d'√âtat ---
      const defaultVideoUrl = "https://res.cloudinary.com/dzmyybvbu/video/upload/v1751377825/videoplayback_1_hftn3c.mp4";
      const defaultThumbnailUrl = "https://res.cloudinary.com/dzmyybvbu/image/upload/v1717255938/thumb_lavage_standard.jpg";
      const defaultBackgroundUrl = "image_672e33.jpg";
      const defaultPauseVideoUrl = "https://res.cloudinary.com/dzmyybvbu/video/upload/v1741207147/samples/elephants.mp4";
      // Couleurs par d√©faut pour le site
      const defaultSiteMainColor = '#343a40';
      const defaultSiteMainColorHover = '#23272b';
      const defaultDynamicCardBg = 'var(--secondary-bg-color)'; // Couleur sombre par d√©faut pour les cartes vid√©o
      const defaultDynamicTextOnCard = 'var(--text-color-light)'; // Texte clair par d√©faut sur les cartes vid√©o sombres

      let videosData = [];
      let themesData = [];
      let fsqsInfoHtmlContent = '';
      let globalPauseVideoUrl = defaultPauseVideoUrl;
      let currentTheme = 'default'; // Stocke le th√®me d'interface ('default' ou 'dark')
      let currentBackgroundUrl = defaultBackgroundUrl;

      let currentGuidedVideoIndex = 0;
      let currentThemePlaylist = [];
      let currentThemeTitle = '';
      let isPlayingPauseVideo = false;

      // --- Fonctions utilitaires pour les couleurs ---
      // Fonction pour assombrir/√©claircir une couleur hex (utilis√©e pour le hover)
      function shadeColor(color, percent) {
          let f=parseInt(color.slice(1),16),t=percent<0?0:255,p=percent<0?percent*-1:percent,R=f>>16,G=(f>>8)&0x00FF,B=f&0x0000FF;
          return "#"+(0x1000000+(Math.round((t-R)*p)+R)*0x10000+(Math.round((t-G)*p)+G)*0x100+(Math.round((t-B)*p)+B)).toString(16).slice(1);
      }

      // Fonction pour d√©terminer si une couleur est claire ou fonc√©e (pour le texte)
      // Bas√© sur la luminosit√© perceptive (luminosity)
      function isColorLight(color) {
          // G√©rer les d√©grad√©s
          if (color.includes('gradient')) {
              // Pour les d√©grad√©s, c'est plus complexe. On peut soit prendre la premi√®re couleur
              // ou appliquer une r√®gle par d√©faut (par exemple, texte fonc√© pour √©viter les probl√®mes)
              // Pour l'instant, on va juste prendre une valeur moyenne ou la premi√®re couleur si c'est un simple d√©grad√©
              const parts = color.match(/#([0-9A-Fa-f]{6})/g);
              if (parts && parts.length > 0) {
                  color = parts[0]; // Prend la premi√®re couleur du d√©grad√©
              } else {
                return false; // Par d√©faut, traiter les d√©grad√©s comme sombres ou complexes pour un texte clair
              }
          }

          // Convertir en RGB si hex
          let r, g, b;
          if (color.startsWith('#')) {
              const hex = color.slice(1);
              r = parseInt(hex.substring(0, 2), 16);
              g = parseInt(hex.substring(2, 4), 16);
              b = parseInt(hex.substring(4, 6), 16);
          } else if (color.startsWith('rgb')) {
              const rgb = color.match(/\d+/g);
              r = parseInt(rgb[0]);
              g = parseInt(rgb[1]);
              b = parseInt(rgb[2]);
          } else {
              return false; // Fallback pour les couleurs non g√©r√©es ou invalides
          }

          // Calcul de la luminosit√© (norme WCAG 2.0)
          const L = (0.2126 * r + 0.7152 * g + 0.0722 * b) / 255;
          return L > 0.5; // Si luminosit√© > 0.5, la couleur est consid√©r√©e comme claire
      }

      function getTextColorForBackground(bgColor) {
          return isColorLight(bgColor) ? defaultSiteMainColor : defaultDynamicTextOnCard; // texte dark si background clair, texte light si background sombre
      }

      // --- Fonctions de Persistance (localStorage) ---
      function saveSettings() {
          localStorage.setItem('videosData', JSON.stringify(videosData));
          localStorage.setItem('themesData', JSON.stringify(themesData)); 
          localStorage.setItem('fsqsInfoHtmlContent', fsqsInfoHtmlContent);
          localStorage.setItem('globalPauseVideoUrl', globalPauseVideoUrl);
          localStorage.setItem('currentTheme', currentTheme);
          localStorage.setItem('currentBackgroundUrl', currentBackgroundUrl);
          localStorage.setItem('siteMainColor', document.documentElement.style.getPropertyValue('--main-bg-color'));
          localStorage.setItem('siteMainColorHover', document.documentElement.style.getPropertyValue('--main-bg-color-hover'));
          localStorage.setItem('dynamicCardBg', document.documentElement.style.getPropertyValue('--dynamic-card-bg'));
          localStorage.setItem('dynamicTextOnCard', document.documentElement.style.getPropertyValue('--dynamic-text-on-card'));
          localStorage.setItem('guidedModeBg', document.documentElement.style.getPropertyValue('--guided-mode-bg'));
          console.log("Param√®tres sauvegard√©s dans localStorage.");
      }

      function loadSettings() {
          const storedVideos = localStorage.getItem('videosData');
          const storedThemes = localStorage.getItem('themesData');
          const storedFsqsInfo = localStorage.getItem('fsqsInfoHtmlContent');
          const storedPauseVideoUrl = localStorage.getItem('globalPauseVideoUrl');
          const storedTheme = localStorage.getItem('currentTheme');
          const storedBackground = localStorage.getItem('currentBackgroundUrl');
          const storedSiteMainColor = localStorage.getItem('siteMainColor');
          const storedSiteMainColorHover = localStorage.getItem('siteMainColorHover');
          const storedDynamicCardBg = localStorage.getItem('dynamicCardBg');
          const storedDynamicTextOnCard = localStorage.getItem('dynamicTextOnCard');
          const storedGuidedModeBg = localStorage.getItem('guidedModeBg');


          if (storedVideos) {
              videosData = JSON.parse(storedVideos);
              // NOUVEAU: Assurer que chaque vid√©o a memoContent
              videosData.forEach(video => {
                  if (!video.memoContent) {
                      video.memoContent = `<p>Cette fiche m√©mo est vide pour le moment. Vous pouvez la modifier dans les param√®tres.</p>`; 
                  }
              });
          } else {
              for (let i = 1; i <= 30; i++) {
                  videosData.push({
                      id: `video-${i}`,
                      src: defaultVideoUrl,
                      thumb: defaultThumbnailUrl,
                      title: `Tutoriel Vid√©o ${i}`,
                      description: `Description pour le Tutoriel Vid√©o ${i} sur un aspect de l'hygi√®ne ou de la s√©curit√©.`,
                      memoContent: `<p>Contenu par d√©faut de la fiche m√©mo pour le Tutoriel Vid√©o ${i}.</p><p>Ceci est un exemple de texte √† retenir.</p>`
                  });
              }
          }

          if (storedThemes) {
              themesData = JSON.parse(storedThemes);
              themesData.forEach(theme => {
                  if (!theme.customColor) {
                      theme.customColor = ''; 
                  }
              });
          } else {
              themesData = [
                  { id: 'hygiene-mains', title: 'Lavage des Mains', icon: 'fas fa-hand-sparkles', playlist: ['Tutoriel Vid√©o 1', 'Tutoriel Vid√©o 2', 'Tutoriel Vid√©o 3'], customColor: '#1a5276' }, // Nuance de bleu
                  { id: 'tracabilite', title: 'Tra√ßabilit√© & DLC', icon: 'fas fa-barcode', playlist: ['Tutoriel Vid√©o 4', 'Tutoriel Vid√©o 5', 'Tutoriel Vid√©o 6'], customColor: '' },
                  { id: 'hygiene-locaux', title: 'Hygi√®ne des Locaux', icon: 'fas fa-broom', playlist: ['Tutoriel Vid√©o 7', 'Tutoriel Vid√©o 8', 'Tutoriel Vid√©o 9'], customColor: '#2874a6' }, // Autre nuance de bleu
                  { id: 'securite-machines', title: 'S√©curit√© Machines', icon: 'fas fa-cog', playlist: ['Tutoriel Vid√©o 10', 'Tutoriel Vid√©o 11', 'Tutoriel Vid√©o 12'], customColor: '' },
                  { id: 'tenue-pro', title: 'Tenue Professionnelle', icon: 'fas fa-tshirt', playlist: ['Tutoriel Vid√©o 13', 'Tutoriel Vid√©o 14'], customColor: '' }
              ];
          }

          if (storedFsqsInfo) {
              fsqsInfoHtmlContent = storedFsqsInfo;
          } else {
              fsqsInfoHtmlContent = `
                  <p>La s√©curit√© alimentaire et la qualit√© sanitaire (FSQS) sont primordiales dans toutes nos op√©rations au Fournil BakeryMaster. Le respect des bonnes pratiques d'hygi√®ne est une responsabilit√© partag√©e qui garantit la salubrit√© de nos produits et la confiance de nos clients.</p>
                  <h3>Pourquoi l'Hygi√®ne des Mains est Cruciale ?</h3>
                  <p>Les mains sont le principal vecteur de transmission des micro-organismes. Une hygi√®ne des mains rigoureuse permet de pr√©venir :</p>
                  <ul>
                    <li>La contamination des aliments par des bact√©ries, virus ou autres agents pathog√®nes.</li>
                    <li>La propagation des maladies au sein du personnel et vers les consommateurs.</li>
                    <li>Les incidents de s√©curit√© alimentaire qui peuvent nuire √† la r√©putation de notre marque.</li>
                  </ul>
                  <img src="image_673211.jpg" alt="Importance de l'hygi√®ne des mains">
                  <em>L'hygi√®ne des mains est la premi√®re ligne de d√©fense contre la contamination.</em>
                  <h3>R√®gles d'Or de la FSQS pour le Personnel</h3>
                  <p>Voici les principes fondamentaux que chaque membre de notre √©quipe doit suivre scrupuleusement :</p>
                  <ul>
                    <li>**Lavage syst√©matique des mains :** Avant de prendre son poste, apr√®s chaque pause, apr√®s √™tre all√© aux toilettes, apr√®s avoir touch√© des surfaces non propres, avant de manipuler des aliments diff√©rents (s√©paration des t√¢ches).</li>
                    <li>**Port de tenues de travail propres :** Blouses, charlottes et chaussures d√©di√©es √† la production, lav√©es r√©guli√®rement.</li>
                    <li>**Pas de bijoux, ni vernis √† ongles :** Ces √©l√©ments peuvent retenir des bact√©ries ou tomber dans les produits.</li>
                    <li>**Signalement imm√©diat :** Toute blessure, sympt√¥me de maladie (diarrh√©e, vomissements, etc.) doit √™tre signal√© √† votre sup√©rieur.</li>
                    <li>**Respect des zones :** Ne pas manger ni boire dans les zones de production.</li>
                  </ul>
                  <p>Ensemble, nous maintenons les standards de qualit√© et de s√©curit√© qui font la r√©putation du Fournil BakeryMaster. Votre vigilance est notre force !</p>
              `;
          }

          if (storedPauseVideoUrl) {
              globalPauseVideoUrl = storedPauseVideoUrl;
          }

          if (storedTheme) {
              currentTheme = storedTheme;
              applyInterfaceTheme(currentTheme);
          }

          if (storedBackground) {
              currentBackgroundUrl = storedBackground;
              applyInterfaceBackground(currentBackgroundUrl);
          }

          // Appliquer les couleurs du site charg√©es (si existantes)
          document.documentElement.style.setProperty('--main-bg-color', storedSiteMainColor || defaultSiteMainColor);
          document.documentElement.style.setProperty('--main-bg-color-hover', storedSiteMainColorHover || defaultSiteMainColorHover);
          document.documentElement.style.setProperty('--dynamic-card-bg', storedDynamicCardBg || defaultDynamicCardBg);
          document.documentElement.style.setProperty('--dynamic-text-on-card', storedDynamicTextOnCard || defaultDynamicTextOnCard);
          document.documentElement.style.setProperty('--guided-mode-bg', storedGuidedModeBg || 'transparent');

          console.log("Param√®tres charg√©s depuis localStorage.");
      }

      // --- Navigation Logique ---
      function showSection(sectionId) {
        document.querySelectorAll('.content-area > div').forEach(section => {
          section.classList.remove('active');
          // NOUVEAU: R√©initialiser les styles dynamiques de la section guid√©e quand on la quitte
          if (section.id === 'guided-wash-mode') {
            section.style.background = ''; // Supprimer le style inline
            section.style.color = ''; // Supprimer le style inline pour le titre h2
            document.documentElement.style.setProperty('--guided-mode-bg', 'transparent'); // R√©initialiser la variable CSS
          }
        });
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
          targetSection.classList.add('active');
        }
      }

      // Initialisation: Charger les param√®tres et afficher le menu principal
      loadSettings();
      showSection('main-menu');

      // Gestion des clics sur les boutons du menu principal
      menuButtons.forEach(button => {
        button.addEventListener('click', () => {
          const targetId = button.dataset.target;
          pauseAllVideos(); // Pause toutes les vid√©os lors du changement de section
          showSection(targetId);

          if (targetId === 'guided-themes-mode') {
              renderThemeGrid(); // Rendre la grille des th√®mes avec les couleurs
          } else if (targetId === 'video-library-mode') {
            document.getElementById('libraryVideoPlayerContainer').style.display = 'none';
            document.getElementById('videoThumbnails').style.display = 'grid'; // S'assurer que la grille est visible
            renderVideoThumbnails(); // S'assurer que la vid√©oth√®que est √† jour
          } else if (targetId === 'fsqs-info-mode') {
            fsqsInfoContentDisplay.innerHTML = fsqsInfoHtmlContent;
          } else if (targetId === 'settings-mode') {
            populateSettingsForms();
          }
        });
      });

      // Gestion des clics sur le bouton Param√®tres global
      settingsGlobalBtn.addEventListener('click', () => {
        showSection('settings-mode');
        pauseAllVideos();
        populateSettingsForms();
      });

      // Gestion des clics sur les boutons "Retour au Menu Principal"
      backToMenuButtons.forEach(button => {
        button.addEventListener('click', () => {
          const targetMode = button.dataset.targetMode;
          if (targetMode) { // Si un mode sp√©cifique est d√©fini, y retourner (ex: retour aux th√®mes depuis le lecteur)
            showSection(targetMode);
            pauseAllVideos();
          } else { // Sinon, retour au menu principal
            showSection('main-menu');
            pauseAllVideos();
          }
        });
      });

      // Fonction pour pauser toutes les vid√©os
      function pauseAllVideos() {
        document.querySelectorAll('video').forEach(video => {
          video.pause();
          video.currentTime = 0;
        });
        updatePlayPauseButton(guidedVideoPlayer, playPauseBtn);
        isPlayingPauseVideo = false; // S'assurer que l'√©tat de la vid√©o de pause est r√©initialis√©
      }

      // Gestion du bouton de d√©connexion
      logoutButton.addEventListener('click', () => {
        if (confirm("√ätes-vous s√ªr de vouloir vous d√©connecter ?")) {
          // localStorage.clear(); // Uncomment if you want a full reset on logout
          window.location.href = 'page_de_login.html'; // Redirection vers page_de_login.html
        }
      });

      // --- Fonctions de contr√¥le vid√©o g√©n√©riques ---
      function setupMainVideoControls(player, playPauseBtn, rewindBtn, forwardBtn) {
          if (playPauseBtn) {
              playPauseBtn.addEventListener('click', () => {
                  if (player.paused || player.ended) {
                      player.play();
                  } else {
                      player.pause();
                  }
                  updatePlayPauseButton(player, playPauseBtn);
              });
              player.addEventListener('play', () => {
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
                enableMainVideoControls(); // S'assurer que les contr√¥les sont actifs
              });
              player.addEventListener('pause', () => playPauseBtn.innerHTML = '<i class="fas fa-play"></i> Lecture');
              player.addEventListener('ended', () => playPauseBtn.innerHTML = '<i class="fas fa-play"></i> Lecture');
          }
          if (rewindBtn) {
              rewindBtn.addEventListener('click', () => {
                  if (!isPlayingPauseVideo) { // N'affecte pas la vid√©o de pause
                      player.currentTime = Math.max(0, player.currentTime - 10);
                  }
              });
          }
          if (forwardBtn) {
              forwardBtn.addEventListener('click', () => {
                  if (!isPlayingPauseVideo) { // N'affecte pas la vid√©o de pause
                      player.currentTime = Math.min(player.duration, player.currentTime + 10);
                  }
              });
          }
      }

      setupMainVideoControls(guidedVideoPlayer, playPauseBtn, rewindBtn, forwardBtn);

      // Fonction pour entrer en mode plein √©cran
      function enterFullscreen(element) {
          if (element.requestFullscreen) {
              element.requestFullscreen();
          } else if (element.mozRequestFullScreen) { /* Firefox */
              element.mozRequestFullScreen();
          } else if (element.webkitRequestFullscreen) { /* Chrome, Safari and Opera */
              element.webkitRequestFullscreen();
          } else if (element.msRequestFullscreen) { /* IE/Edge */
              element.msRequestFullscreen();
          }
      }

      // Gestionnaire pour le bouton plein √©cran du lecteur guid√©
      if (fullscreenGuidedBtn) {
          fullscreenGuidedBtn.addEventListener('click', () => {
              enterFullscreen(guidedVideoPlayer);
          });
      }

      // Gestionnaire pour le bouton plein √©cran du lecteur de la vid√©oth√®que
      if (fullscreenLibraryBtn) {
          fullscreenLibraryBtn.addEventListener('click', () => {
              enterFullscreen(libraryVideoPlayer);
          });
      }

      function updatePlayPauseButton(player, button) {
          if (!button) return; 
          if (player.paused || player.ended) {
              button.innerHTML = '<i class="fas fa-play"></i> Lecture';
          } else {
              button.innerHTML = '<i class="fas fa-pause"></i> Pause';
          }
      }

      function enableMainVideoControls() {
        playPauseBtn.disabled = false;
        rewindBtn.disabled = false;
        forwardBtn.disabled = false;
        // infoMemoBtn.style.display = 'block'; // Afficher le bouton info/m√©mo
      }

      function disableMainVideoControls() {
        playPauseBtn.disabled = true;
        rewindBtn.disabled = true;
        forwardBtn.disabled = true;
        // infoMemoBtn.style.display = 'none'; // Cacher le bouton info/m√©mo
      }

      // --- Logique du "Lavage Guid√©" (S√©quence de Th√®mes et de Vid√©os) ---

      function findVideoByTitle(title) {
        return videosData.find(video => video.title === title);
      }

      function loadAndPlayGuidedVideo(index) {
          if (index >= 0 && index < currentThemePlaylist.length) {
              const videoToPlay = findVideoByTitle(currentThemePlaylist[index]);
              if (videoToPlay) {
                  guidedVideoPlayer.src = videoToPlay.src;
                  guidedVideoPlayer.load();
                  guidedVideoPlayer.play();
                  isPlayingPauseVideo = false;
                  updateGuidedSequenceButtons(index);
                  updatePlayPauseButton(guidedVideoPlayer, playPauseBtn);
                  enableMainVideoControls();
                  
                  // NOUVEAU: Mettre √† jour la visibilit√© et le dataset du bouton info/m√©mo
                  infoMemoBtn.style.display = 'block';
                  infoMemoBtn.dataset.currentVideoTitle = videoToPlay.title;

              } else {
                  console.error("Vid√©o non trouv√©e dans la vid√©oth√®que pour le titre :", currentThemePlaylist[index]);
                  // Tenter de passer √† la vid√©o suivante si la vid√©o actuelle est introuvable
                  if (index < currentThemePlaylist.length - 1) {
                    currentGuidedVideoIndex++;
                    loadAndPlayGuidedVideo(currentGuidedVideoIndex);
                  } else {
                    alert("Fin de la s√©quence du th√®me. Certaines vid√©os n'ont pas pu √™tre charg√©es. Veuillez v√©rifier les titres dans les param√®tres des th√®mes.");
                    resetGuidedSequence();
                  }
              }
          } else {
              alert("Fin de la s√©quence du th√®me.");
              resetGuidedSequence();
          }
      }

      function playGuidedPauseVideo() {
          isPlayingPauseVideo = true;
          guidedVideoPlayer.src = globalPauseVideoUrl; 
          guidedVideoPlayer.load();
          guidedVideoPlayer.play();
          updatePlayPauseButton(guidedVideoPlayer, playPauseBtn); 
          disableMainVideoControls(); 
          infoMemoBtn.style.display = 'none'; // Cacher le bouton info/m√©mo pendant la pause
      }

      function updateGuidedSequenceButtons(index) {
          prevSeqBtn.disabled = (index === 0 && !isPlayingPauseVideo); 
          nextSeqBtn.disabled = (index === currentThemePlaylist.length - 1 && !isPlayingPauseVideo); 
          restartSeqBtn.disabled = false; 
      }
      
      // Mettre √† jour les boutons si le mode plein √©cran est activ√©/d√©sactiv√©
      document.addEventListener('fullscreenchange', () => {
          updateGuidedSequenceButtons(currentGuidedVideoIndex);
      });
      document.addEventListener('webkitfullscreenchange', () => {
          updateGuidedSequenceButtons(currentGuidedVideoIndex);
      });
      document.addEventListener('mozfullscreenchange', () => {
          updateGuidedSequenceButtons(currentGuidedVideoIndex);
      });
      document.addEventListener('msfullscreenchange', () => {
          updateGuidedSequenceButtons(currentGuidedVideoIndex);
      });

      function resetGuidedSequence() {
          currentGuidedVideoIndex = 0;
          guidedVideoPlayer.src = '';
          guidedVideoPlayer.load();
          updateGuidedSequenceButtons(currentGuidedVideoIndex);
          updatePlayPauseButton(guidedVideoPlayer, playPauseBtn);
          enableMainVideoControls(); 
          isPlayingPauseVideo = false;
          infoMemoBtn.style.display = 'none'; // Cacher le bouton info/m√©mo
      }
      
      guidedVideoPlayer.addEventListener('ended', () => {
          if (isPlayingPauseVideo) { // Si c'√©tait la vid√©o de pause
              isPlayingPauseVideo = false;
              currentGuidedVideoIndex++;
              loadAndPlayGuidedVideo(currentGuidedVideoIndex);
          } else { // Si c'√©tait une vid√©o de contenu
              if (currentGuidedVideoIndex < currentThemePlaylist.length - 1) {
                  playGuidedPauseVideo(); 
              } else {
                  alert("S√©quence du th√®me termin√©e !");
                  resetGuidedSequence();
                  // Quitter le plein √©cran si n√©cessaire
                  if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement) {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                  }
                  showSection('guided-themes-mode'); 
              }
          }
      });

      prevSeqBtn.addEventListener('click', () => {
          if (currentGuidedVideoIndex > 0 && !isPlayingPauseVideo) { 
              currentGuidedVideoIndex--;
              loadAndPlayGuidedVideo(currentGuidedVideoIndex);
          } else if (isPlayingPauseVideo) { 
              isPlayingPauseVideo = false; 
              loadAndPlayGuidedVideo(currentGuidedVideoIndex); 
          }
      });

      nextSeqBtn.addEventListener('click', () => {
          if (isPlayingPauseVideo) { 
              isPlayingPauseVideo = false;
              currentGuidedVideoIndex++;
              loadAndPlayGuidedVideo(currentGuidedVideoIndex);
          } else if (currentGuidedVideoIndex < currentThemePlaylist.length - 1) {
              currentGuidedVideoIndex++;
              loadAndPlayGuidedVideo(currentGuidedVideoIndex);
          } else {
              alert("Vous √™tes √† la fin de la s√©quence du th√®me.");
              resetGuidedSequence();
              if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement) {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
              }
              showSection('guided-themes-mode'); 
          }
      });

      restartSeqBtn.addEventListener('click', () => {
          loadGuidedVideoSequence(currentThemeTitle); // Red√©marrer la s√©quence du th√®me actuel
      });

      function loadGuidedVideoSequence(themeTitle) {
        const selectedTheme = themesData.find(t => t.title === themeTitle);
        if (selectedTheme) {
            currentThemePlaylist = selectedTheme.playlist;
            currentThemeTitle = selectedTheme.title;
            guidedThemeTitle.textContent = selectedTheme.title; 
            currentGuidedVideoIndex = 0;
            isPlayingPauseVideo = false; 
            
            // NOUVEAU: Appliquer la couleur du th√®me √† la section guid√©e
            const guidedWashModeSection = document.getElementById('guided-wash-mode');
            if (selectedTheme.customColor) {
                guidedWashModeSection.style.background = selectedTheme.customColor;
                document.documentElement.style.setProperty('--guided-mode-bg', selectedTheme.customColor);
                // Appliquer la couleur de texte appropri√©e (noir sur fond clair, blanc sur fond sombre)
                document.documentElement.style.setProperty('--dynamic-text-on-card', getTextColorForBackground(selectedTheme.customColor));
            } else {
                guidedWashModeSection.style.background = ''; // Revert to CSS default (transparent)
                document.documentElement.style.setProperty('--guided-mode-bg', 'transparent');
                document.documentElement.style.setProperty('--dynamic-text-on-card', defaultDynamicTextOnCard); // Revert to default
            }

            if (currentThemePlaylist.length > 0) {
                loadAndPlayGuidedVideo(currentGuidedVideoIndex);
            } else {
                alert(`Le th√®me "${selectedTheme.title}" ne contient aucune vid√©o. Veuillez en ajouter dans les param√®tres.`);
                showSection('guided-themes-mode'); 
            }
        } else {
            console.error("Th√®me non trouv√© :", themeTitle);
            alert("Th√®me non trouv√©.");
            showSection('guided-themes-mode');
        }
      }

      // --- Mode "S√©lection de Th√®mes Guid√©s" ---
      function renderThemeGrid() {
        themeGrid.innerHTML = '';
        themesData.forEach(theme => {
          const themeItem = document.createElement('div');
          themeItem.classList.add('theme-item');
          themeItem.dataset.themeId = theme.id;
          themeItem.dataset.themeTitle = theme.title;
          
          // Appliquer l'image de fond si elle existe
          if (theme.backgroundImage) {
              themeItem.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url(${theme.backgroundImage})`;
              themeItem.style.backgroundSize = 'cover';
              themeItem.style.backgroundPosition = 'center';
          } else {
              // Appliquer la couleur personnalis√©e si elle existe, sinon utiliser la valeur par d√©faut CSS
              if (theme.customColor) {
                  if (theme.customColor.includes('gradient')) {
                    themeItem.style.background = theme.customColor;
                  } else {
                    themeItem.style.backgroundColor = theme.customColor;
                  }
              } else {
                  themeItem.style.backgroundColor = '';
                  themeItem.style.background = '';
              }
          }

          // D√©terminer si l'ic√¥ne est un emoji ou une classe FontAwesome
          const isEmoji = theme.icon && !theme.icon.includes('fa-') && !theme.icon.includes('fas ') && !theme.icon.includes('far ') && !theme.icon.includes('fab ');
          
          if (isEmoji) {
              themeItem.innerHTML = `
                <div class="theme-icon" style="font-size: 3em;">${theme.icon}</div>
                <h3 class="theme-title">${theme.title}</h3>
              `;
          } else {
              themeItem.innerHTML = `
                <i class="${theme.icon || 'fas fa-book'} theme-icon"></i>
                <h3 class="theme-title">${theme.title}</h3>
              `;
          }
          
          themeGrid.appendChild(themeItem);
        });
      }

      themeGrid.addEventListener('click', (event) => {
        const themeItem = event.target.closest('.theme-item');
        if (themeItem) {
          const themeTitle = themeItem.dataset.themeTitle;
          showSection('guided-wash-mode'); 
          loadGuidedVideoSequence(themeTitle);
        }
      });

      // --- Logique de la "Vid√©oth√®que" ---
      function renderVideoThumbnails() {
          videoThumbnailsContainer.innerHTML = ''; // Vider le conteneur actuel
          videosData.forEach(video => {
              const videoItem = document.createElement('div');
              videoItem.classList.add('video-item');
              videoItem.dataset.videoId = video.id; 
              videoItem.dataset.videoSrc = video.src;
              videoItem.dataset.title = video.title;
              videoItem.dataset.description = video.description;
              videoItem.innerHTML = `
                  <img src="${video.thumb}" alt="${video.title}">
                  <div class="play-overlay"><i class="fas fa-play"></i></div>
                  <div class="video-item-info">
                      <h3>${video.title}</h3>
                      <p>${video.description}</p>
                  </div>
              `;
              videoThumbnailsContainer.appendChild(videoItem);
          });
      }

      libraryVideoPlayer.addEventListener('ended', () => {
        libraryVideoPlayerContainer.style.display = 'none';
        videoThumbnailsContainer.style.display = 'grid'; 
        libraryVideoPlayer.src = ""; 
      });

      // Cacher le lecteur et r√©afficher la grille si on clique en dehors de la vid√©o ou de ses contr√¥les (y compris les nouveaux contr√¥les du lecteur de la vid√©oth√®que)
      libraryVideoPlayerContainer.addEventListener('click', (event) => {
          const target = event.target;
          if (target === libraryVideoPlayer || libraryVideoPlayer.contains(target) || target.closest('.video-controls')) {
              return; 
          }
          libraryVideoPlayer.pause();
          libraryVideoPlayerContainer.style.display = 'none';
          videoThumbnailsContainer.style.display = 'grid';
          libraryVideoPlayer.src = ""; 
      });


      videoThumbnailsContainer.addEventListener('click', (event) => {
        const videoItem = event.target.closest('.video-item');
        if (videoItem) {
          const videoSrc = videoItem.dataset.videoSrc;
          libraryVideoPlayer.src = videoSrc;
          libraryVideoPlayerContainer.style.display = 'block'; 
          videoThumbnailsContainer.style.display = 'none'; 
          libraryVideoPlayer.load(); 
          libraryVideoPlayer.play();
        }
      });

      // --- Logique des Param√®tres ---
      function populateSettingsForms() {
        // Remplir la liste d√©roulante des th√®mes
        editThemeSelect.innerHTML = '<option value="">-- S√©lectionner un th√®me --</option>';
        selectThemeForColor.innerHTML = '<option value="">-- S√©lectionner un th√®me --</option>'; 
        selectThemeForMemo.innerHTML = '<option value="">-- Choisir un th√®me --</option>'; // NOUVEAU: pour les fiches m√©mo
        themesData.forEach(theme => {
            const option = document.createElement('option');
            option.value = theme.id;
            option.textContent = theme.title;
            editThemeSelect.appendChild(option);
            selectThemeForColor.appendChild(option.cloneNode(true)); 
            selectThemeForMemo.appendChild(option.cloneNode(true)); // Cloner pour le s√©lecteur de m√©mo
        });

        // Remplir la liste d√©roulante des vid√©os pour ajouter √† un th√®me
        selectVideoToAdd.innerHTML = '<option value="">-- S√©lectionner une vid√©o --</option>';
        videosData.forEach(video => {
            const option = document.createElement('option');
            option.value = video.title; 
            option.textContent = video.title;
            selectVideoToAdd.appendChild(option);
        });

        // Remplir la liste d√©roulante des vid√©os √† modifier/supprimer
        editVideoSelect.innerHTML = '<option value="">-- Cr√©er une nouvelle vid√©o --</option>';
        videosData.forEach(video => {
            const option = document.createElement('option');
            option.value = video.id;
            option.textContent = video.title;
            editVideoSelect.appendChild(option);
        });

        // R√©initialiser les champs et les boutons d'action des vid√©os
        clearVideoForm();
        updateVideoActionButtons();

        // Initialiser l'URL de la vid√©o de pause
        pauseVideoUrlInput.value = globalPauseVideoUrl;

        // Initialiser le contenu du textarea des infos FSQS
        fsqsInfoTextarea.value = fsqsInfoHtmlContent;

        // Initialiser le th√®me d'interface et l'arri√®re-plan
        themeSelect.value = currentTheme;
        backgroundImageUrlInput.value = currentBackgroundUrl;

        // Initialiser les champs des param√®tres de couleurs
        colorApplyToSelect.value = 'site'; 
        themeColorSelectorDiv.style.display = 'none'; 
        customColorCodeInput.value = '';
        colorPickerInput.value = '#343a40'; 
        colorPresetSelect.value = '';

        // NOUVEAU: R√©initialiser les champs de gestion des fiches m√©mo
        selectVideoForMemo.innerHTML = '<option value="">-- Choisir une vid√©o --</option>';
        memoContentTextarea.value = '';
        selectThemeForMemo.value = '';
        labelSelectVideoForMemo.style.display = 'none';
        selectVideoForMemo.style.display = 'none';
        labelMemoContentTextarea.style.display = 'none';
        memoContentTextarea.style.display = 'none';
        updateMemoContentBtn.style.display = 'none';
      }

      function clearVideoForm() {
          videoTitleInput.value = '';
          videoUrlInput.value = '';
          videoThumbnailInput.value = '';
          videoDescriptionInput.value = '';
          editVideoSelect.value = ''; 
      }

      function updateVideoActionButtons() {
          const selectedVideoId = editVideoSelect.value;
          if (selectedVideoId) {
              addNewVideoBtn.disabled = true;
              modifyVideoBtn.disabled = false;
              deleteVideoBtn.disabled = false;
          } else {
              addNewVideoBtn.disabled = false;
              modifyVideoBtn.disabled = true;
              deleteVideoBtn.disabled = true;
          }
      }

      // Quand un th√®me est s√©lectionn√©, pr√©-remplir sa playlist et ses propri√©t√©s
      editThemeSelect.addEventListener('change', () => {
          const selectedThemeId = editThemeSelect.value;
          const selectedTheme = themesData.find(t => t.id === selectedThemeId);
          if (selectedTheme) {
              themePlaylistInput.value = selectedTheme.playlist.join(', ');
              editThemeIconInput.value = selectedTheme.icon || '';
              editThemeBackgroundInput.value = selectedTheme.backgroundImage || '';
          } else {
              themePlaylistInput.value = '';
              editThemeIconInput.value = '';
              editThemeBackgroundInput.value = '';
          }
      });

      // Quand une vid√©o est s√©lectionn√©e dans le dropdown "editVideoSelect"
      editVideoSelect.addEventListener('change', () => {
          const selectedVideoId = editVideoSelect.value;
          if (selectedVideoId) {
              const selectedVideo = videosData.find(v => v.id === selectedVideoId);
              if (selectedVideo) {
                  videoTitleInput.value = selectedVideo.title;
                  videoUrlInput.value = selectedVideo.src;
                  videoThumbnailInput.value = selectedVideo.thumb;
                  videoDescriptionInput.value = selectedVideo.description;
              }
          } else {
              clearVideoForm(); 
          }
          updateVideoActionButtons();
      });

      // Bouton "Ajouter Nouvelle Vid√©o"
      addNewVideoBtn.addEventListener('click', () => {
          const newVideo = {
              id: videoTitleInput.value.trim().toLowerCase().replace(/\s/g, '-').replace(/[^\w-]/g, ''), 
              title: videoTitleInput.value.trim(),
              src: videoUrlInput.value.trim(),
              thumb: videoThumbnailInput.value.trim(),
              description: videoDescriptionInput.value.trim(),
              memoContent: `<p>Contenu par d√©faut de la fiche m√©mo pour la nouvelle vid√©o.</p>` // NOUVEAU
          };

          if (newVideo.title && newVideo.src && newVideo.thumb) {
              const existingIndex = videosData.findIndex(v => v.id === newVideo.id || v.title === newVideo.title);
              if (existingIndex > -1) {
                  alert('Une vid√©o avec ce titre ou un ID similaire existe d√©j√†. Veuillez utiliser le bouton "Modifier" ou choisir un titre diff√©rent.');
                  return;
              }
              videosData.push(newVideo); 
              alert('Nouvelle vid√©o ajout√©e !');
              saveSettings(); 
              renderVideoThumbnails(); 
              populateSettingsForms(); 
          } else {
              alert('Veuillez remplir tous les champs obligatoires (Titre, URL Vid√©o, URL Miniature) pour ajouter une vid√©o.');
          }
      });

      // Bouton "Modifier la Vid√©o S√©lectionn√©e"
      modifyVideoBtn.addEventListener('click', () => {
          const selectedVideoId = editVideoSelect.value;
          if (!selectedVideoId) {
              alert('Veuillez s√©lectionner une vid√©o √† modifier.');
              return;
          }

          const videoToModifyIndex = videosData.findIndex(v => v.id === selectedVideoId);
          if (videoToModifyIndex > -1) {
              const oldTitle = videosData[videoToModifyIndex].title;
              const updatedVideo = {
                  id: videosData[videoToModifyIndex].id, 
                  title: videoTitleInput.value.trim(),
                  src: videoUrlInput.value.trim(),
                  thumb: videoThumbnailInput.value.trim(),
                  description: videoDescriptionInput.value.trim(),
                  memoContent: videosData[videoToModifyIndex].memoContent // Conserver le contenu m√©mo existant
              };

              if (updatedVideo.title && updatedVideo.src && updatedVideo.thumb) {
                  const existingOtherIndex = videosData.findIndex(v => v.title === updatedVideo.title && v.id !== selectedVideoId);
                  if (existingOtherIndex > -1) {
                      alert('Une autre vid√©o existe d√©j√† avec ce titre. Veuillez utiliser un titre unique.');
                      return;
                  }

                  if (oldTitle !== updatedVideo.title) {
                      updatedVideo.id = updatedVideo.title.toLowerCase().replace(/\s/g, '-').replace(/[^\w-]/g, '');
                      themesData.forEach(theme => {
                          theme.playlist = theme.playlist.map(videoTitle => 
                              videoTitle === oldTitle ? updatedVideo.title : videoTitle
                          );
                      });
                  }

                  videosData[videoToModifyIndex] = updatedVideo;
                  alert('Vid√©o modifi√©e avec succ√®s !');
                  saveSettings();
                  renderVideoThumbnails();
                  populateSettingsForms();
              } else {
                  alert('Veuillez remplir tous les champs obligatoires (Titre, URL Vid√©o, URL Miniature) pour modifier la vid√©o.');
              }
          }
      });

      // Bouton "Supprimer la Vid√©o S√©lectionn√©e"
      deleteVideoBtn.addEventListener('click', () => {
          const selectedVideoId = editVideoSelect.value;
          if (!selectedVideoId) {
              alert('Veuillez s√©lectionner une vid√©o √† supprimer.');
              return;
          }

          const videoToDelete = videosData.find(v => v.id === selectedVideoId);
          if (videoToDelete && confirm(`√ätes-vous s√ªr de vouloir supprimer la vid√©o "${videoToDelete.title}" ?`)) {
              videosData = videosData.filter(v => v.id !== selectedVideoId);

              themesData.forEach(theme => {
                  theme.playlist = theme.playlist.filter(videoTitle => videoTitle !== videoToDelete.title);
              });

              alert('Vid√©o supprim√©e !');
              saveSettings();
              renderVideoThumbnails(); 
              populateSettingsForms(); 
          }
      });

      addThemeBtn.addEventListener('click', () => {
          const newThemeTitle = themeTitleInput.value.trim();
          const newThemeIcon = themeIconInput.value.trim() || 'fas fa-book';
          const newThemeBackground = themeBackgroundInput.value.trim();
          
          if (newThemeTitle) {
              const newThemeId = newThemeTitle.toLowerCase().replace(/\s/g, '-').replace(/[^\w-]/g, '');
              if (!themesData.some(t => t.id === newThemeId)) {
                  themesData.push({ 
                    id: newThemeId, 
                    title: newThemeTitle, 
                    icon: newThemeIcon,
                    backgroundImage: newThemeBackground,
                    playlist: [], 
                    customColor: '' 
                  }); 
                  alert(`Th√®me "${newThemeTitle}" ajout√© !`);
                  themeTitleInput.value = '';
                  themeIconInput.value = '';
                  themeBackgroundInput.value = '';
                  saveSettings(); 
                  populateSettingsForms();
                  renderThemeGrid(); 
              } else {
                  alert('Un th√®me avec ce titre existe d√©j√†.');
              }
          } else {
              alert('Veuillez entrer un titre pour le nouveau th√®me.');
          }
      });

      updateThemeBtn.addEventListener('click', () => {
          const selectedThemeId = editThemeSelect.value;
          const newPlaylistTitles = themePlaylistInput.value.split(',').map(title => title.trim()).filter(title => title !== '');
          const newIcon = editThemeIconInput.value.trim();
          const newBackgroundImage = editThemeBackgroundInput.value.trim();
          
          if (!selectedThemeId) {
              alert('Veuillez s√©lectionner un th√®me √† modifier.');
              return;
          }

          const selectedTheme = themesData.find(t => t.id === selectedThemeId);
          if (selectedTheme) {
              const allExist = newPlaylistTitles.every(title => findVideoByTitle(title));
              if (allExist || newPlaylistTitles.length === 0) {
                selectedTheme.playlist = newPlaylistTitles;
                selectedTheme.icon = newIcon || selectedTheme.icon;
                selectedTheme.backgroundImage = newBackgroundImage;
                alert(`Th√®me "${selectedTheme.title}" mis √† jour !`);
                saveSettings(); 
                renderThemeGrid();
              } else {
                alert('Certaines vid√©os sp√©cifi√©es dans la playlist n\'existent pas dans la vid√©oth√®que. Veuillez v√©rifier les titres.');
              }
          }
      });

      deleteThemeBtn.addEventListener('click', () => {
          const selectedThemeId = editThemeSelect.value;
          if (selectedThemeId && confirm("√ätes-vous s√ªr de vouloir supprimer ce th√®me et sa playlist ?")) {
              themesData = themesData.filter(t => t.id !== selectedThemeId);
              alert('Th√®me supprim√© !');
              saveSettings(); 
              populateSettingsForms();
              themePlaylistInput.value = ''; 
          } else if (!selectedThemeId) {
              alert('Veuillez s√©lectionner un th√®me √† supprimer.');
          }
      });

      addSelectedVideoToThemeBtn.addEventListener('click', () => {
          const selectedThemeId = editThemeSelect.value;
          const videoTitleToAdd = selectVideoToAdd.value;

          if (!selectedThemeId) {
              alert('Veuillez s√©lectionner un th√®me d\'abord.');
              return;
          }
          if (!videoTitleToAdd) {
              alert('Veuillez s√©lectionner une vid√©o √† ajouter.');
              return;
          }

          const selectedTheme = themesData.find(t => t.id === selectedThemeId);
          if (selectedTheme) {
              if (!selectedTheme.playlist.includes(videoTitleToAdd)) {
                  selectedTheme.playlist.push(videoTitleToAdd);
                  themePlaylistInput.value = selectedTheme.playlist.join(', '); 
                  alert(`Vid√©o "${videoTitleToAdd}" ajout√©e √† la playlist du th√®me "${selectedTheme.title}" !`);
                  saveSettings(); 
              } else {
                  alert(`La vid√©o "${videoTitleToAdd}" est d√©j√† dans la playlist de ce th√®me.`);
              }
          }
      });

      function applyInterfaceTheme(theme) {
        if (theme === 'dark') {
            document.documentElement.style.setProperty('--card-bg-color', 'rgba(0, 0, 0, 0.85)');
            document.documentElement.style.setProperty('--secondary-bg-color', 'rgba(20, 20, 20, 0.9)'); // Plus sombre pour les vid√©os
            document.documentElement.style.setProperty('--text-color-dark', '#f0f0f0');
            document.documentElement.style.setProperty('--text-color-light', '#333');
            document.documentElement.style.setProperty('--input-bg-color', '#444');
            document.documentElement.style.setProperty('--input-border-color', '#666');
            // Ces variables sont maintenant aussi affect√©es par les couleurs personnalis√©es
            // document.documentElement.style.setProperty('--main-bg-color', '#555'); 
            // document.documentElement.style.setProperty('--main-bg-color-hover', '#666'); 
        } else {
            // Revert to default
            document.documentElement.style.setProperty('--card-bg-color', 'rgba(255, 255, 255, 0.85)');
            document.documentElement.style.setProperty('--secondary-bg-color', 'rgba(0, 0, 0, 0.8)');
            document.documentElement.style.setProperty('--text-color-dark', '#333');
            document.documentElement.style.setProperty('--text-color-light', '#f0f0f0');
            document.documentElement.style.setProperty('--input-bg-color', '#f8f9fa');
            document.documentElement.style.setProperty('--input-border-color', '#ced4da');
            // document.documentElement.style.setProperty('--main-bg-color', '#343a40');
            // document.documentElement.style.setProperty('--main-bg-color-hover', '#23272b');
        }
        currentTheme = theme; 
      }

      applyThemeBtn.addEventListener('click', () => {
          applyInterfaceTheme(themeSelect.value);
          saveSettings(); 
          alert('Th√®me appliqu√© !');
      });

      function applyInterfaceBackground(url) {
        if (url) {
            document.body.style.backgroundImage = `url('${url}')`;
        } else {
            document.body.style.backgroundImage = `url('${defaultBackgroundUrl}')`; 
        }
        currentBackgroundUrl = url; 
      }

      applyBackgroundBtn.addEventListener('click', () => {
          const newBgUrl = backgroundImageUrlInput.value.trim();
          applyInterfaceBackground(newBgUrl);
          saveSettings(); 
          alert('Image de fond appliqu√©e !');
      });

      setPauseVideoBtn.addEventListener('click', () => {
          const newPauseVideoUrl = pauseVideoUrlInput.value.trim();
          if (newPauseVideoUrl) {
              globalPauseVideoUrl = newPauseVideoUrl; 
              saveSettings(); 
              alert('URL de la vid√©o de pause mise √† jour !');
          } else {
              alert('Veuillez entrer une URL pour la vid√©o de pause.');
          }
      });

      updateFsqsInfoBtn.addEventListener('click', () => {
          fsqsInfoHtmlContent = fsqsInfoTextarea.value;
          saveSettings(); 
          alert('Informations FSQS mises √† jour !');
          if (document.getElementById('fsqs-info-mode').classList.contains('active')) {
            fsqsInfoContentDisplay.innerHTML = fsqsInfoHtmlContent;
          }
      });

      // --- Fonctions d'application des couleurs ---
      function applySiteWideColor(colorCode) {
          document.documentElement.style.setProperty('--main-bg-color', colorCode);
          if (!colorCode.includes('gradient')) {
              document.documentElement.style.setProperty('--main-bg-color-hover', shadeColor(colorCode, -0.1)); 
          } else {
              document.documentElement.style.setProperty('--main-bg-color-hover', defaultSiteMainColorHover); 
          }
          // Quand on change la couleur du site entier, les cartes vid√©o retrouvent leur style par d√©faut
          document.documentElement.style.setProperty('--dynamic-card-bg', defaultDynamicCardBg);
          document.documentElement.style.setProperty('--dynamic-text-on-card', defaultDynamicTextOnCard);
          document.documentElement.style.setProperty('--guided-mode-bg', 'transparent'); // Le fond de la section guid√©e revient √† transparent
          renderThemeGrid(); // Rafra√Æchir les th√®mes pour s'assurer qu'ils reprennent leur couleur par d√©faut si pas personnalis√©e
      }

      function applyThemeSpecificColor(themeId, colorCode) {
          const theme = themesData.find(t => t.id === themeId);
          if (theme) {
              theme.customColor = colorCode;
              // Mettre √† jour les variables pour le th√®me ACTUELLEMENT EN COURS (si applicable)
              if (currentThemeTitle && theme.title === currentThemeTitle) {
                  const guidedWashModeSection = document.getElementById('guided-wash-mode');
                  guidedWashModeSection.style.background = colorCode;
                  document.documentElement.style.setProperty('--guided-mode-bg', colorCode);
                  // Appliquer la couleur de texte appropri√©e au titre du th√®me GUIDED
                  document.documentElement.style.setProperty('--dynamic-text-on-card', getTextColorForBackground(colorCode));
              }
          }
          renderThemeGrid(); // Rafra√Æchit l'affichage des th√®mes pour que les disquettes aient la bonne couleur
      }

      function resetAllColors() {
          document.documentElement.style.setProperty('--main-bg-color', defaultSiteMainColor);
          document.documentElement.style.setProperty('--main-bg-color-hover', defaultSiteMainColorHover);
          document.documentElement.style.setProperty('--dynamic-card-bg', defaultDynamicCardBg);
          document.documentElement.style.setProperty('--dynamic-text-on-card', defaultDynamicTextOnCard);
          document.documentElement.style.setProperty('--guided-mode-bg', 'transparent');
          
          themesData.forEach(theme => {
              if (theme.id === 'hygiene-mains') {
                  theme.customColor = '#1a5276';
              } else if (theme.id === 'hygiene-locaux') {
                  theme.customColor = '#2874a6';
              } else {
                  theme.customColor = ''; 
              }
          });
          saveSettings();
          alert('Toutes les couleurs ont √©t√© r√©initialis√©es aux valeurs par d√©faut.');
          populateSettingsForms(); 
          renderThemeGrid(); 
      }

      // --- √âcouteurs d'√©v√©nements pour les param√®tres de couleurs ---

      colorApplyToSelect.addEventListener('change', () => {
          if (colorApplyToSelect.value === 'theme') {
              themeColorSelectorDiv.style.display = 'block';
          } else {
              themeColorSelectorDiv.style.display = 'none';
          }
      });

      colorPickerInput.addEventListener('input', () => {
          customColorCodeInput.value = colorPickerInput.value;
          colorPresetSelect.value = ''; 
      });

      customColorCodeInput.addEventListener('input', () => {
          const value = customColorCodeInput.value;
          if (value.match(/^#[0-9A-Fa-f]{6}$/)) { 
              colorPickerInput.value = value;
          }
          colorPresetSelect.value = ''; 
      });

      colorPresetSelect.addEventListener('change', () => {
          const selectedPreset = colorPresetSelect.value;
          if (selectedPreset) {
              customColorCodeInput.value = selectedPreset;
              if (selectedPreset.match(/^#[0-9A-Fa-f]{6}$/)) { 
                  colorPickerInput.value = selectedPreset;
              } else {
                  colorPickerInput.value = '#343a40'; 
              }
          }
      });

      applyColorBtn.addEventListener('click', () => {
          const colorCode = customColorCodeInput.value.trim();
          if (!colorCode) {
              alert('Veuillez entrer ou s√©lectionner un code couleur ou un d√©grad√©.');
              return;
          }

          const applyTo = colorApplyToSelect.value;

          if (applyTo === 'site') {
              applySiteWideColor(colorCode);
              alert('Couleur appliqu√©e √† tout le portail !');
          } else if (applyTo === 'theme') {
              const selectedThemeId = selectThemeForColor.value;
              if (!selectedThemeId) {
                  alert('Veuillez s√©lectionner un th√®me pour appliquer la couleur.');
                  return;
              }
              applyThemeSpecificColor(selectedThemeId, colorCode);
              alert('Couleur appliqu√©e au th√®me s√©lectionn√© !');
          }
          saveSettings(); 
      });

      resetColorsBtn.addEventListener('click', () => {
          if (confirm("√ätes-vous s√ªr de vouloir r√©initialiser TOUTES les couleurs (site et th√®mes) aux valeurs par d√©faut ?")) {
              resetAllColors();
          }
      });

      // --- NOUVEAU: Fonctions d'Export/Import des donn√©es ---
      
      exportDataBtn.addEventListener('click', () => {
          const allData = {
              videosData: videosData,
              themesData: themesData,
              fsqsInfoHtmlContent: fsqsInfoHtmlContent,
              globalPauseVideoUrl: globalPauseVideoUrl,
              currentTheme: currentTheme,
              currentBackgroundUrl: currentBackgroundUrl,
              siteSettings: {
                  siteMainColor: document.documentElement.style.getPropertyValue('--main-bg-color'),
                  siteMainColorHover: document.documentElement.style.getPropertyValue('--main-bg-color-hover'),
                  dynamicCardBg: document.documentElement.style.getPropertyValue('--dynamic-card-bg'),
                  dynamicTextOnCard: document.documentElement.style.getPropertyValue('--dynamic-text-on-card'),
                  guidedModeBg: document.documentElement.style.getPropertyValue('--guided-mode-bg')
              },
              exportDate: new Date().toISOString(),
              version: '1.0'
          };
          
          const dataStr = JSON.stringify(allData, null, 2);
          const dataBlob = new Blob([dataStr], {type: 'application/json'});
          
          const link = document.createElement('a');
          link.href = URL.createObjectURL(dataBlob);
          link.download = `portail-tutoriels-data-${new Date().toISOString().split('T')[0]}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          alert('Donn√©es export√©es avec succ√®s !');
      });
      
      importDataBtn.addEventListener('click', () => {
          const file = importDataFile.files[0];
          if (!file) {
              alert('Veuillez s√©lectionner un fichier JSON √† importer.');
              return;
          }
          
          if (!confirm('L\'import remplacera toutes vos donn√©es actuelles. √ätes-vous s√ªr de vouloir continuer ?')) {
              return;
          }
          
          const reader = new FileReader();
          reader.onload = function(e) {
              try {
                  const importedData = JSON.parse(e.target.result);
                  
                  // Validation basique
                  if (!importedData.videosData || !importedData.themesData) {
                      alert('Le fichier JSON ne contient pas les donn√©es attendues.');
                      return;
                  }
                  
                  // Import des donn√©es
                  videosData = importedData.videosData || [];
                  themesData = importedData.themesData || [];
                  fsqsInfoHtmlContent = importedData.fsqsInfoHtmlContent || '';
                  globalPauseVideoUrl = importedData.globalPauseVideoUrl || '';
                  currentTheme = importedData.currentTheme || 'light';
                  currentBackgroundUrl = importedData.currentBackgroundUrl || '';
                  
                  // Import des param√®tres de style
                  if (importedData.siteSettings) {
                      const settings = importedData.siteSettings;
                      if (settings.siteMainColor) document.documentElement.style.setProperty('--main-bg-color', settings.siteMainColor);
                      if (settings.siteMainColorHover) document.documentElement.style.setProperty('--main-bg-color-hover', settings.siteMainColorHover);
                      if (settings.dynamicCardBg) document.documentElement.style.setProperty('--dynamic-card-bg', settings.dynamicCardBg);
                      if (settings.dynamicTextOnCard) document.documentElement.style.setProperty('--dynamic-text-on-card', settings.dynamicTextOnCard);
                      if (settings.guidedModeBg) document.documentElement.style.setProperty('--guided-mode-bg', settings.guidedModeBg);
                  }
                  
                  // Appliquer les param√®tres import√©s
                  applyInterfaceTheme(currentTheme);
                  applyInterfaceBackground(currentBackgroundUrl);
                  
                  // Sauvegarder et rafra√Æchir l'affichage
                  saveSettings();
                  populateSettingsForms();
                  renderVideoThumbnails();
                  renderThemeGrid();
                  if (document.getElementById('fsqs-info-mode').classList.contains('active')) {
                      fsqsInfoContentDisplay.innerHTML = fsqsInfoHtmlContent;
                  }
                  
                  alert(`Donn√©es import√©es avec succ√®s ! (${importedData.videosData.length} vid√©os, ${importedData.themesData.length} th√®mes)`);
                  
              } catch (error) {
                  alert('Erreur lors de l\'import : le fichier JSON n\'est pas valide.');
                  console.error('Erreur d\'import:', error);
              }
          };
          
          reader.readAsText(file);
      });


      // --- NOUVEAU: Logique de gestion des Fiches M√©mo ---

      // Remplir le s√©lecteur de vid√©os pour les fiches m√©mo quand un th√®me est choisi
      selectThemeForMemo.addEventListener('change', () => {
          const selectedThemeId = selectThemeForMemo.value;
          selectVideoForMemo.innerHTML = '<option value="">-- Choisir une vid√©o --</option>';
          memoContentTextarea.value = '';

          if (selectedThemeId) {
              const selectedTheme = themesData.find(t => t.id === selectedThemeId);
              if (selectedTheme) {
                  selectedTheme.playlist.forEach(videoTitle => {
                      const video = findVideoByTitle(videoTitle);
                      if (video) {
                          const option = document.createElement('option');
                          option.value = video.id; // Utiliser l'ID pour identifier la vid√©o de mani√®re unique
                          option.textContent = video.title;
                          selectVideoForMemo.appendChild(option);
                      }
                  });
              }
              labelSelectVideoForMemo.style.display = 'block';
              selectVideoForMemo.style.display = 'block';
          } else {
              labelSelectVideoForMemo.style.display = 'none';
              selectVideoForMemo.style.display = 'none';
              labelMemoContentTextarea.style.display = 'none';
              memoContentTextarea.style.display = 'none';
              updateMemoContentBtn.style.display = 'none';
          }
      });

      // Afficher le contenu de la fiche m√©mo quand une vid√©o est s√©lectionn√©e
      selectVideoForMemo.addEventListener('change', () => {
          const selectedVideoId = selectVideoForMemo.value;
          if (selectedVideoId) {
              const video = videosData.find(v => v.id === selectedVideoId);
              if (video) {
                  memoContentTextarea.value = video.memoContent || '';
                  labelMemoContentTextarea.style.display = 'block';
                  memoContentTextarea.style.display = 'block';
                  updateMemoContentBtn.style.display = 'block';
              }
          } else {
              memoContentTextarea.value = '';
              labelMemoContentTextarea.style.display = 'none';
              memoContentTextarea.style.display = 'none';
              updateMemoContentBtn.style.display = 'none';
          }
      });

      // Mettre √† jour le contenu de la fiche m√©mo
      updateMemoContentBtn.addEventListener('click', () => {
          const selectedVideoId = selectVideoForMemo.value;
          if (!selectedVideoId) {
              alert('Veuillez s√©lectionner une vid√©o pour laquelle mettre √† jour la fiche m√©mo.');
              return;
          }
          const video = videosData.find(v => v.id === selectedVideoId);
          if (video) {
              video.memoContent = memoContentTextarea.value.trim();
              saveSettings();
              alert('Fiche m√©mo mise √† jour avec succ√®s !');
          }
      });

      // --- NOUVEAU: Logique de la Modale (Popup) ---
      infoMemoBtn.addEventListener('click', () => {
          const currentVideoTitle = infoMemoBtn.dataset.currentVideoTitle;
          const video = findVideoByTitle(currentVideoTitle);
          if (video && video.memoContent) {
              memoModalTitle.textContent = `Fiche M√©mo: ${video.title}`;
              memoModalContent.innerHTML = video.memoContent;
              memoModal.style.display = 'block';
              pauseAllVideos(); // Pause la vid√©o principale lors de l'ouverture du m√©mo
          } else {
              alert('Aucune fiche m√©mo disponible pour cette vid√©o.');
          }
      });

      closeModalBtn.addEventListener('click', () => {
          memoModal.style.display = 'none';
          // Si la vid√©o √©tait en cours avant la pause, la relancer
          // (logique √† affiner si n√©cessaire, mais simple par d√©faut)
          if (guidedVideoPlayer.src && !guidedVideoPlayer.paused) {
            guidedVideoPlayer.play();
          }
      });

      // Fermer la modale si l'utilisateur clique en dehors du contenu
      window.addEventListener('click', (event) => {
          if (event.target == memoModal) {
              memoModal.style.display = 'none';
              if (guidedVideoPlayer.src && !guidedVideoPlayer.paused) {
                guidedVideoPlayer.play();
              }
          }
      });

    }); // Fin de DOMContentLoaded
  </script>
<!-- Static App Form Collection Script -->
<script src="https://static.app/js/static-forms.js" type="text/javascript"></script>

<script src="https://static.app/js/static.js" type="text/javascript"></script>
</body>
</html>
